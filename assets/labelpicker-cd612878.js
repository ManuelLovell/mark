import{a as k,O as l,C as w,b as B,S as C}from"./style-5d5d86f4.js";class O{static async UpdateLabel(i,c,u,b){const h=k(i.id,c.Id),f=await l.scene.items.getItems([h]),N="#242424",y=parseInt(u),g=i.grid.dpi/150;let o=0;if(f.length===0){const e=await l.scene.items.getItems(a=>a.attachedTo===i.id&&a.type==="LABEL"&&a.style.pointerDirection===T(c.Direction));if(e.length>0){for(let a=0;a<e.length+1;a++)if(!e.find(x=>x.metadata[`${w.EXTENSIONID}/place`].placement===a)){o=a;break}}let r={};r[`${w.EXTENSIONID}/place`]={placement:o};const t=B().fillColor(c.Color).plainText(c.Name).strokeWidth(5).build();t.id=h,t.type="LABEL",t.attachedTo=i.id,t.visible=!!i.visible,t.locked=!0,t.position={x:i.position.x,y:i.position.y},t.metadata=r;let s,p=15,m=15;c.Direction=="Top"&&(t.position.y-=i.image.height*i.scale.y/4/g,s="DOWN",e.length>0&&o!==0&&(t.position.y-=15,t.position.y-=y*o)),c.Direction=="Bottom"&&(t.position.y+=i.image.height*i.scale.y/4/g,s="UP",e.length>0&&o!==0&&(t.position.y+=15,t.position.y+=y*o)),c.Direction=="Right"&&(t.position.x+=i.image.width*i.scale.x/4/g,s="LEFT",e.length>0&&o!==0&&(t.position.y+=y*o)),c.Direction=="Left"&&(t.position.x-=i.image.width*i.scale.x/4/g,s="RIGHT",e.length>0&&o!==0&&(t.position.y-=y*o)),e.length>0&&o!==0&&(p=0,m=0),t.style={backgroundColor:N,backgroundOpacity:+b/100,pointerDirection:s,pointerWidth:m,pointerHeight:p,cornerRadius:10},await l.scene.items.addItems([t])}else await l.scene.items.deleteItems([h]);function T(e){switch(e){case"Top":return"DOWN";case"Bottom":return"UP";case"Right":return"LEFT";case"Left":return"RIGHT";default:throw new Error("Invalid direction")}}}}l.onReady(async()=>{document.documentElement.style.borderRadius="16px",document.documentElement.style.height="100%";const L=window.location.search,i=new URLSearchParams(L),c=i.get("targetid"),u=i.get("multi"),b=u?c.split(","):[];let h=[];const f=await l.scene.items.getItems(u?b:[c]);u||(h=await l.scene.items.getItems(e=>e.attachedTo===f[0].id&&e.type==="LABEL"));const N=await l.theme.getTheme();C(N,document),l.theme.onChange(e=>{C(e,document)});const o=(await l.room.getMetadata())[`${w.EXTENSIONID}/metadata_marks`]?.saveData;if(o&&o.Labels?.length>0){let e=function(n){n==="#1"?(r.style.display="",t.style.display="none",s.style.display="none"):n==="#2"?(r.style.display="none",t.style.display="",s.style.display="none"):(r.style.display="none",t.style.display="none",s.style.display="")};const r=document.querySelector("#label-list1"),t=document.querySelector("#label-list2"),s=document.querySelector("#label-list3"),p=document.createElement("button");p.className="categoryButton",p.onclick=()=>e("#1");const m=document.createElement("button");m.className="categoryButton",m.onclick=()=>e("#2");const a=document.createElement("button");a.className="categoryButton",a.onclick=()=>e("#3");const E=document.querySelector(".footered");E.appendChild(p),E.appendChild(m),E.appendChild(a),o.Groups.forEach(n=>{switch(n.Num){case"#1":p.innerText=n.Name;break;case"#2":m.innerText=n.Name;break;case"#3":a.innerText=n.Name;break;default:throw new Error("Invalid Group")}}),o.Labels.forEach(n=>{if(n.Active){const I=h.find(S=>S.text.plainText===n.Name),d=document.createElement("button");d.id=`toggle-${n.Id}`,d.className=`group1${I?" highlight":""}`,d.value=n.Name,d.title=n.Name,d.textContent=n.Name,n.Group==="#1"?r.appendChild(d):n.Group==="#2"?t.appendChild(d):s.appendChild(d)}}),document.querySelectorAll(".group1").forEach(n=>{n.addEventListener("click",async I=>await T(I.currentTarget))}),e("#1")}else document.querySelector("#label-list1").innerHTML=`
        <div>
        No labels found.
        </div>`;async function T(e){const r=e.id.substring(7),t=o.Labels.find(s=>s.Id===r);u||(e.className=e.className==="group1"?"group1 highlight":"group1"),f.forEach(async s=>{await O.UpdateLabel(s,t,o.Distance,o.Opacity)})}});
