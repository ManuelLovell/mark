import{O as x,C as V,i as qe,L as $e,S as ge,a as Ue,G as Ve,b as je,H as We,R as Xe}from"./label-logic-b7237c1f.js";function ze(l){return l.type==="IMAGE"}const Ye="com.battle-system.mark-menu";function Ke(){x.contextMenu.create({id:`${Ye}/context-menu`,icons:[{icon:"/tag1.svg",label:"Mark It",filter:{some:[{key:"layer",value:"CHARACTER",coordinator:"||"},{key:"layer",value:"MOUNT"}]}}],async onClick(l,n){l.items.length==1?await x.popover.open({id:V.LABELSID,url:"/labelpicker.html",height:250,width:300,anchorElementId:n}):await x.popover.open({id:V.LABELSID,url:"/labelpicker.html",height:250,width:300,anchorElementId:n})},embed:{url:"/labelpicker.html?contextmenu=true",height:200}})}var G=function(){/*!
* Copyright (c) 2021-2023 Momo Bassit.
* Licensed under the MIT License (MIT)
* https://github.com/mdbassit/Coloris
* Version: 0.19.0
* NPM: https://github.com/melloware/coloris-npm
*/return function(l,n,o){var h=n.createElement("canvas").getContext("2d"),v={r:0,g:0,b:0,h:0,s:0,v:0,a:1},b,c,f,u,w,I,F,T,p,g,N,L,S,E,M,R,re,r={el:"[data-coloris]",parent:"body",theme:"default",themeMode:"light",rtl:!1,wrap:!0,margin:2,format:"hex",formatToggle:!1,swatches:[],swatchesOnly:!1,alpha:!0,forceAlpha:!1,focusInput:!0,selectInput:!1,inline:!1,defaultColor:"#000000",clearButton:!1,clearLabel:"Clear",closeButton:!1,closeLabel:"Close",onChange:function(){},a11y:{open:"Open color picker",close:"Close color picker",clear:"Clear the selected color",marker:"Saturation: {s}. Brightness: {v}.",hueSlider:"Hue slider",alphaSlider:"Opacity slider",input:"Color value field",format:"Color format",swatch:"Color swatch",instruction:"Saturation and brightness selector. Use up, down, left and right arrow keys to select."}},j={},ne="",W={},X=!1;function K(e){if(typeof e=="object"){var t=function(){switch(a){case"el":le(e.el),e.wrap!==!1&&J(e.el);break;case"parent":b=n.querySelector(e.parent),b&&(b.appendChild(c),r.parent=e.parent,b===n.body&&(b=null));break;case"themeMode":r.themeMode=e.themeMode,e.themeMode==="auto"&&l.matchMedia&&l.matchMedia("(prefers-color-scheme: dark)").matches&&(r.themeMode="dark");case"theme":e.theme&&(r.theme=e.theme),c.className="clr-picker clr-"+r.theme+" clr-"+r.themeMode,r.inline&&z();break;case"rtl":r.rtl=!!e.rtl,n.querySelectorAll(".clr-field").forEach(function(D){return D.classList.toggle("clr-rtl",r.rtl)});break;case"margin":e.margin*=1,r.margin=isNaN(e.margin)?r.margin:e.margin;break;case"wrap":e.el&&e.wrap&&J(e.el);break;case"formatToggle":r.formatToggle=!!e.formatToggle,B("clr-format").style.display=r.formatToggle?"block":"none",r.formatToggle&&(r.format="auto");break;case"swatches":if(Array.isArray(e.swatches)){var s=[];e.swatches.forEach(function(D,be){s.push('<button type="button" id="clr-swatch-'+be+'" aria-labelledby="clr-swatch-label clr-swatch-'+be+'" style="color: '+D+';">'+D+"</button>")}),B("clr-swatches").innerHTML=s.length?"<div>"+s.join("")+"</div>":"",r.swatches=e.swatches.slice()}break;case"swatchesOnly":r.swatchesOnly=!!e.swatchesOnly,c.setAttribute("data-minimal",r.swatchesOnly);break;case"alpha":r.alpha=!!e.alpha,c.setAttribute("data-alpha",r.alpha);break;case"inline":if(r.inline=!!e.inline,c.setAttribute("data-inline",r.inline),r.inline){var d=e.defaultColor||r.defaultColor;M=oe(d),z(),Y(d)}break;case"clearButton":typeof e.clearButton=="object"&&(e.clearButton.label&&(r.clearLabel=e.clearButton.label,T.innerHTML=r.clearLabel),e.clearButton=e.clearButton.show),r.clearButton=!!e.clearButton,T.style.display=r.clearButton?"block":"none";break;case"clearLabel":r.clearLabel=e.clearLabel,T.innerHTML=r.clearLabel;break;case"closeButton":r.closeButton=!!e.closeButton,r.closeButton?c.insertBefore(p,I):I.appendChild(p);break;case"closeLabel":r.closeLabel=e.closeLabel,p.innerHTML=r.closeLabel;break;case"a11y":var m=e.a11y,k=!1;if(typeof m=="object")for(var y in m)m[y]&&r.a11y[y]&&(r.a11y[y]=m[y],k=!0);if(k){var A=B("clr-open-label"),H=B("clr-swatch-label");A.innerHTML=r.a11y.open,H.innerHTML=r.a11y.swatch,p.setAttribute("aria-label",r.a11y.close),T.setAttribute("aria-label",r.a11y.clear),g.setAttribute("aria-label",r.a11y.hueSlider),L.setAttribute("aria-label",r.a11y.alphaSlider),F.setAttribute("aria-label",r.a11y.input),f.setAttribute("aria-label",r.a11y.instruction)}break;default:r[a]=e[a]}};for(var a in e)t()}}function Ae(e,t){typeof e=="string"&&typeof t=="object"&&(j[e]=t,X=!0)}function xe(e){delete j[e],Object.keys(j).length===0&&(X=!1,e===ne&&ie())}function pe(e){if(X){var t=["el","wrap","rtl","inline","defaultColor","a11y"],a=function(){var m=j[i];if(e.matches(i)){ne=i,W={},t.forEach(function(y){return delete m[y]});for(var k in m)W[k]=Array.isArray(r[k])?r[k].slice():r[k];return K(m),"break"}};for(var i in j){var s=a();if(s==="break")break}}}function ie(){Object.keys(W).length>0&&(K(W),ne="",W={})}function le(e){C(n,"click",e,function(t){r.inline||(pe(t.target),E=t.target,R=E.value,M=oe(R),c.classList.add("clr-open"),z(),Y(R),(r.focusInput||r.selectInput)&&F.focus({preventScroll:!0}),r.selectInput&&F.select(),(re||r.swatchesOnly)&&ye().shift().focus(),E.dispatchEvent(new Event("open",{bubbles:!0})))}),C(n,"input",e,function(t){var a=t.target.parentNode;a.classList.contains("clr-field")&&(a.style.color=t.target.value)})}function z(){if(!(!c||!E&&!r.inline)){var e=b,t=l.scrollY,a=c.offsetWidth,i=c.offsetHeight,s={left:!1,top:!1},d,m,k,y={x:0,y:0};if(e&&(d=l.getComputedStyle(e),m=parseFloat(d.marginTop),k=parseFloat(d.borderTopWidth),y=e.getBoundingClientRect(),y.y+=k+t),!r.inline){var A=E.getBoundingClientRect(),H=A.x,D=t+A.y+A.height+r.margin;e?(H-=y.x,D-=y.y,H+a>e.clientWidth&&(H+=A.width-a,s.left=!0),D+i>e.clientHeight-m&&i+r.margin<=A.top-(y.y-t)&&(D-=A.height+i+r.margin*2,s.top=!0),D+=e.scrollTop):(H+a>n.documentElement.clientWidth&&(H+=A.width-a,s.left=!0),D+i-t>n.documentElement.clientHeight&&i+r.margin<=A.top&&(D=t+A.y-i-r.margin,s.top=!0)),c.classList.toggle("clr-left",s.left),c.classList.toggle("clr-top",s.top),c.style.left=H+"px",c.style.top=D+"px",y.x+=c.offsetLeft,y.y+=c.offsetTop}u={width:f.offsetWidth,height:f.offsetHeight,x:f.offsetLeft+y.x,y:f.offsetTop+y.y}}}function J(e){n.querySelectorAll(e).forEach(function(t){var a=t.parentNode;if(!a.classList.contains("clr-field")){var i=n.createElement("div"),s="clr-field";(r.rtl||t.classList.contains("clr-rtl"))&&(s+=" clr-rtl"),i.innerHTML='<button type="button" aria-labelledby="clr-open-label"></button>',a.insertBefore(i,t),i.setAttribute("class",s),i.style.color=t.value,i.appendChild(t)}})}function $(e){if(E&&!r.inline){var t=E;e&&(E=null,R!==t.value&&(t.value=R,t.dispatchEvent(new Event("input",{bubbles:!0})))),setTimeout(function(){R!==t.value&&t.dispatchEvent(new Event("change",{bubbles:!0}))}),c.classList.remove("clr-open"),X&&ie(),t.dispatchEvent(new Event("close",{bubbles:!0})),r.focusInput&&t.focus({preventScroll:!0}),E=null}}function Y(e){var t=Me(e),a=Ge(t);he(a.s,a.v),Q(t,a),g.value=a.h,c.style.color="hsl("+a.h+", 100%, 50%)",N.style.left=a.h/360*100+"%",w.style.left=u.width*a.s/100+"px",w.style.top=u.height-u.height*a.v/100+"px",L.value=a.a*100,S.style.left=a.a*100+"%"}function oe(e){var t=e.substring(0,3).toLowerCase();return t==="rgb"||t==="hsl"?t:"hex"}function O(e){e=e!==void 0?e:F.value,E&&(E.value=e,E.dispatchEvent(new Event("input",{bubbles:!0}))),r.onChange&&r.onChange.call(l,e),n.dispatchEvent(new CustomEvent("coloris:pick",{detail:{color:e}}))}function me(e,t){var a={h:g.value*1,s:e/u.width*100,v:100-t/u.height*100,a:L.value/100},i=Se(a);he(a.s,a.v),Q(i,a),O()}function he(e,t){var a=r.a11y.marker;e=e.toFixed(1)*1,t=t.toFixed(1)*1,a=a.replace("{s}",e),a=a.replace("{v}",t),w.setAttribute("aria-label",a)}function Ie(e){return{pageX:e.changedTouches?e.changedTouches[0].pageX:e.pageX,pageY:e.changedTouches?e.changedTouches[0].pageY:e.pageY}}function q(e){var t=Ie(e),a=t.pageX-u.x,i=t.pageY-u.y;b&&(i+=b.scrollTop),ve(a,i),e.preventDefault(),e.stopPropagation()}function Te(e,t){var a=w.style.left.replace("px","")*1+e,i=w.style.top.replace("px","")*1+t;ve(a,i)}function ve(e,t){e=e<0?0:e>u.width?u.width:e,t=t<0?0:t>u.height?u.height:t,w.style.left=e+"px",w.style.top=t+"px",me(e,t),w.focus()}function Q(e,t){e===void 0&&(e={}),t===void 0&&(t={});var a=r.format;for(var i in e)v[i]=e[i];for(var s in t)v[s]=t[s];var d=He(v),m=d.substring(0,7);switch(w.style.color=m,S.parentNode.style.color=m,S.style.color=d,I.style.color=d,f.style.display="none",f.offsetHeight,f.style.display="",S.nextElementSibling.style.display="none",S.nextElementSibling.offsetHeight,S.nextElementSibling.style.display="",a==="mixed"?a=v.a===1?"hex":"rgb":a==="auto"&&(a=M),a){case"hex":F.value=d;break;case"rgb":F.value=Re(v);break;case"hsl":F.value=Oe(De(v));break}n.querySelector('.clr-format [value="'+a+'"]').checked=!0}function Ne(){var e=g.value*1,t=w.style.left.replace("px","")*1,a=w.style.top.replace("px","")*1;c.style.color="hsl("+e+", 100%, 50%)",N.style.left=e/360*100+"%",me(t,a)}function Be(){var e=L.value/100;S.style.left=e*100+"%",Q({a:e}),O()}function Se(e){var t=e.s/100,a=e.v/100,i=t*a,s=e.h/60,d=i*(1-o.abs(s%2-1)),m=a-i;i=i+m,d=d+m;var k=o.floor(s)%6,y=[i,d,m,m,d,i][k],A=[d,i,i,d,m,m][k],H=[m,m,d,i,i,d][k];return{r:o.round(y*255),g:o.round(A*255),b:o.round(H*255),a:e.a}}function De(e){var t=e.v/100,a=t*(1-e.s/100/2),i;return a>0&&a<1&&(i=o.round((t-a)/o.min(a,1-a)*100)),{h:e.h,s:i||0,l:o.round(a*100),a:e.a}}function Ge(e){var t=e.r/255,a=e.g/255,i=e.b/255,s=o.max(t,a,i),d=o.min(t,a,i),m=s-d,k=s,y=0,A=0;return m&&(s===t&&(y=(a-i)/m),s===a&&(y=2+(i-t)/m),s===i&&(y=4+(t-a)/m),s&&(A=m/s)),y=o.floor(y*60),{h:y<0?y+360:y,s:o.round(A*100),v:o.round(k*100),a:e.a}}function Me(e){var t=/^((rgba)|rgb)[\D]+([\d.]+)[\D]+([\d.]+)[\D]+([\d.]+)[\D]*?([\d.]+|$)/i,a,i;return h.fillStyle="#000",h.fillStyle=e,a=t.exec(h.fillStyle),a?(i={r:a[3]*1,g:a[4]*1,b:a[5]*1,a:a[6]*1},i.a=+i.a.toFixed(2)):(a=h.fillStyle.replace("#","").match(/.{2}/g).map(function(s){return parseInt(s,16)}),i={r:a[0],g:a[1],b:a[2],a:1}),i}function He(e){var t=e.r.toString(16),a=e.g.toString(16),i=e.b.toString(16),s="";if(e.r<16&&(t="0"+t),e.g<16&&(a="0"+a),e.b<16&&(i="0"+i),r.alpha&&(e.a<1||r.forceAlpha)){var d=e.a*255|0;s=d.toString(16),d<16&&(s="0"+s)}return"#"+t+a+i+s}function Re(e){return!r.alpha||e.a===1&&!r.forceAlpha?"rgb("+e.r+", "+e.g+", "+e.b+")":"rgba("+e.r+", "+e.g+", "+e.b+", "+e.a+")"}function Oe(e){return!r.alpha||e.a===1&&!r.forceAlpha?"hsl("+e.h+", "+e.s+"%, "+e.l+"%)":"hsla("+e.h+", "+e.s+"%, "+e.l+"%, "+e.a+")"}function Pe(){n.getElementById("clr-picker")||(b=null,c=n.createElement("div"),c.setAttribute("id","clr-picker"),c.className="clr-picker",c.innerHTML='<input id="clr-color-value" name="clr-color-value" class="clr-color" type="text" value="" spellcheck="false" aria-label="'+r.a11y.input+'">'+('<div id="clr-color-area" class="clr-gradient" role="application" aria-label="'+r.a11y.instruction+'">')+'<div id="clr-color-marker" class="clr-marker" tabindex="0"></div></div><div class="clr-hue">'+('<input id="clr-hue-slider" name="clr-hue-slider" type="range" min="0" max="360" step="1" aria-label="'+r.a11y.hueSlider+'">')+'<div id="clr-hue-marker"></div></div><div class="clr-alpha">'+('<input id="clr-alpha-slider" name="clr-alpha-slider" type="range" min="0" max="100" step="1" aria-label="'+r.a11y.alphaSlider+'">')+'<div id="clr-alpha-marker"></div><span></span></div><div id="clr-format" class="clr-format"><fieldset class="clr-segmented">'+("<legend>"+r.a11y.format+"</legend>")+'<input id="clr-f1" type="radio" name="clr-format" value="hex"><label for="clr-f1">Hex</label><input id="clr-f2" type="radio" name="clr-format" value="rgb"><label for="clr-f2">RGB</label><input id="clr-f3" type="radio" name="clr-format" value="hsl"><label for="clr-f3">HSL</label><span></span></fieldset></div><div id="clr-swatches" class="clr-swatches"></div>'+('<button type="button" id="clr-clear" class="clr-clear" aria-label="'+r.a11y.clear+'">'+r.clearLabel+"</button>")+'<div id="clr-color-preview" class="clr-preview">'+('<button type="button" id="clr-close" class="clr-close" aria-label="'+r.a11y.close+'">'+r.closeLabel+"</button>")+"</div>"+('<span id="clr-open-label" hidden>'+r.a11y.open+"</span>")+('<span id="clr-swatch-label" hidden>'+r.a11y.swatch+"</span>"),n.body.appendChild(c),f=B("clr-color-area"),w=B("clr-color-marker"),T=B("clr-clear"),p=B("clr-close"),I=B("clr-color-preview"),F=B("clr-color-value"),g=B("clr-hue-slider"),N=B("clr-hue-marker"),L=B("clr-alpha-slider"),S=B("clr-alpha-marker"),le(r.el),J(r.el),C(c,"mousedown",function(e){c.classList.remove("clr-keyboard-nav"),e.stopPropagation()}),C(f,"mousedown",function(e){C(n,"mousemove",q)}),C(f,"touchstart",function(e){n.addEventListener("touchmove",q,{passive:!1})}),C(w,"mousedown",function(e){C(n,"mousemove",q)}),C(w,"touchstart",function(e){n.addEventListener("touchmove",q,{passive:!1})}),C(F,"change",function(e){(E||r.inline)&&(Y(F.value),O())}),C(T,"click",function(e){O(""),$()}),C(p,"click",function(e){O(),$()}),C(n,"click",".clr-format input",function(e){M=e.target.value,Q(),O()}),C(c,"click",".clr-swatches button",function(e){Y(e.target.textContent),O(),r.swatchesOnly&&$()}),C(n,"mouseup",function(e){n.removeEventListener("mousemove",q)}),C(n,"touchend",function(e){n.removeEventListener("touchmove",q)}),C(n,"mousedown",function(e){re=!1,c.classList.remove("clr-keyboard-nav"),$()}),C(n,"keydown",function(e){var t=e.key,a=e.target,i=e.shiftKey,s=["Tab","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"];if(t==="Escape"?$(!0):s.includes(t)&&(re=!0,c.classList.add("clr-keyboard-nav")),t==="Tab"&&a.matches(".clr-picker *")){var d=ye(),m=d.shift(),k=d.pop();i&&a===m?(k.focus(),e.preventDefault()):!i&&a===k&&(m.focus(),e.preventDefault())}}),C(n,"click",".clr-field button",function(e){X&&ie(),e.target.nextElementSibling.dispatchEvent(new Event("click",{bubbles:!0}))}),C(w,"keydown",function(e){var t={ArrowUp:[0,-1],ArrowDown:[0,1],ArrowLeft:[-1,0],ArrowRight:[1,0]};Object.keys(t).includes(e.key)&&(Te.apply(void 0,t[e.key]),e.preventDefault())}),C(f,"click",q),C(g,"input",Ne),C(L,"input",Be))}function ye(){var e=Array.from(c.querySelectorAll("input, button")),t=e.filter(function(a){return!!a.offsetWidth});return t}function B(e){return n.getElementById(e)}function C(e,t,a,i){var s=Element.prototype.matches||Element.prototype.msMatchesSelector;typeof a=="string"?e.addEventListener(t,function(d){s.call(d.target,a)&&i.call(d.target,d)}):(i=a,e.addEventListener(t,i))}function ce(e,t){t=t!==void 0?t:[],n.readyState!=="loading"?e.apply(void 0,t):n.addEventListener("DOMContentLoaded",function(){e.apply(void 0,t)})}NodeList!==void 0&&NodeList.prototype&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach);function _e(e,t){E=t,R=E.value,pe(t),M=oe(e),z(),Y(e),O(),R!==e&&E.dispatchEvent(new Event("change",{bubbles:!0}))}var se=function(){var e={init:Pe,set:K,wrap:J,close:$,setInstance:Ae,setColor:_e,removeInstance:xe,updatePosition:z};function t(s){ce(function(){s&&(typeof s=="string"?le(s):K(s))})}var a=function(d){t[d]=function(){for(var m=arguments.length,k=new Array(m),y=0;y<m;y++)k[y]=arguments[y];ce(e[d],k)}};for(var i in e)a(i);return ce(function(){l.addEventListener("resize",function(s){t.updatePosition()}),l.addEventListener("scroll",function(s){t.updatePosition()})}),t}();return se.coloris=se,se}(window,document,Math)}();G.coloris;G.init;G.set;G.wrap;G.close;G.setInstance;G.removeInstance;G.updatePosition;function Je(){x.broadcast.onMessage(V.MARKCONNECT,async l=>{if(Array.isArray(l.data)){const n=l.data;if(n.length>0){const o=await x.room.getMetadata(),h=await x.scene.items.getItems(u=>ze(u)),b=o[`${V.EXTENSIONID}/metadata_marks`]?.saveData;let c=b.Distance??"36",f=b.Opacity??"85";for(const u of n){const w={Active:1,Direction:u.Direction??"Top",Color:qe(u.Color)?u.Color:"#FFFFFF",Group:"#1",Name:u.LabelName,Id:`TID-${u.LabelName}`},I=b.Labels.find(T=>T.Name?.toLowerCase().includes(u.LabelName?.toLowerCase()));I&&(w.Name=I.Name,w.Direction=I.Direction,w.Color=I.Color,w.Id=I.Id);const F=h.find(T=>T.id===u.TokenId);F&&await $e.UpdateLabel(F,w,c,f,u.Show)}}}})}G.init();G.coloris({el:".coloris",alpha:!1,format:"hex",wrap:!0,theme:"polaroid",themeMode:"light",swatches:["red","yellow","green","cyan","blue","purple"],onChange:l=>{console.log(l)}});G.close();document.querySelector("#app").innerHTML=`
  <div id="loadingApp" class="center">Loading...</div>
  <div id="labelApp" style="display:none;">
    <div id="controlContainer">
        <div style="display:flex;"><div id="bannerText">Marked!</div><div id="patreonContainer"></div></div>
        <div id="buttonLabels">
        <div class="nameGroup center">
        <label for="gr1n">Group #1</label><br>
        <input type="text" id="gr1n" name="gr1n" maxlength="15" size="10">
        </div>
        <div class="nameGroup center">
        <label for="gr2n">Group #2</label><br>
        <input type="text" id="gr2n" name="gr2n" maxlength="15" size="10">
        </div>
        <div class="nameGroup center">
        <label for="gr3n">Group #3</label><br>
        <input type="text" id="gr3n" name="gr3n" maxlength="15" size="10">
        </div>
        </div>
        <div id="mainButtonsGroup" class="center">
        <label for="distance">Size: </label><input type="number" id="distance" name="distance">
        <label for="distance">Opacity: </label><input type="number" id="opacity" name="opacity">
        <div id="mainButtons"></div></div>
    </div>
    <div id="tableContainer">
        <table id="table-one" style="width:100%">
        <thead>
        <tr id="tableHeader">
        <th style="width: 5%">🔛</th>
        <th id="labelSort" style="width: 55%">Label Name</th>
        <th style="width: 10%">Group</th>
        <th style="width: 20%">Direction</th>
        <th style="width: 10%">🖍️</th>
        </tr>
        </thead>
        <tbody id="label-list"></tbody>
        </table>
    </div>
  </div>
  `;const we=document.getElementById("loadingApp"),Qe=document.getElementById("labelApp"),Ce=document.getElementById("label-list"),Ze=document.getElementById("labelSort");let ue=!0;const U=document.getElementById("mainButtons"),ee=document.getElementById("gr1n"),te=document.getElementById("gr2n"),ae=document.getElementById("gr3n"),P=document.getElementById("distance"),_=document.getElementById("opacity"),et=[{Id:"1",Name:"Blinded 🕶️",Color:"#FFFFFF",Group:"#1",Direction:"Top",Active:1},{Id:"2",Name:"Charmed 💘",Color:"#ff0000",Group:"#1",Direction:"Top",Active:1},{Id:"3",Name:"Deafened 🎧",Color:"#FFFFFF",Group:"#1",Direction:"Top",Active:1},{Id:"4",Name:"Frightened 😱",Color:"#FFFFFF",Group:"#1",Direction:"Top",Active:1},{Id:"5",Name:"Grappled 🫂",Color:"#FFFFFF",Group:"#1",Direction:"Top",Active:1},{Id:"6",Name:"Incapacitated 💘",Color:"#FFFFFF",Group:"#1",Direction:"Top",Active:1},{Id:"7",Name:"Invisible 😶‍🌫️",Color:"#FFFFFF",Group:"#1",Direction:"Top",Active:1},{Id:"8",Name:"Paralyzed ⚡",Color:"#FFFFFF",Group:"#1",Direction:"Top",Active:1},{Id:"9",Name:"Petrified 🪨",Color:"#FFFFFF",Group:"#1",Direction:"Top",Active:1},{Id:"10",Name:"Poisoned 🤢",Color:"#008000",Group:"#1",Direction:"Top",Active:1},{Id:"11",Name:"Prone 🦦",Color:"#FFFFFF",Group:"#1",Direction:"Top",Active:1},{Id:"12",Name:"Restrained 🪢",Color:"#FFFFFF",Group:"#1",Direction:"Top",Active:1},{Id:"13",Name:"Stunned 💫",Color:"#FFFFFF",Group:"#1",Direction:"Top",Active:1},{Id:"14",Name:"Unconscious 💤",Color:"#FFFFFF",Group:"#1",Direction:"Top",Active:1},{Id:"15",Name:"Exhaustion 🦥",Color:"#FFFFFF",Group:"#1",Direction:"Top",Active:1},{Id:"16",Name:"Bardic Inspiration 🎵",Color:"#FFFFFF",Group:"#2",Direction:"Left",Active:1},{Id:"17",Name:"Champion 👑",Color:"#FFFFFF",Group:"#3",Direction:"Right",Active:1}],de=["Conditions","Buffs","Extra"],ke="36",Ee="85";x.onReady(async()=>{Ke();const l=await x.theme.getTheme();ge(l,document),x.theme.onChange(o=>{ge(o,document)}),await x.player.getRole()==="GM"?(await Ue(),document.getElementById("patreonContainer").appendChild(Ve()),await ot(),Je()):(we.innerHTML='<div class="player-view">Configuration is GM-Access only.</div>',await x.action.setHeight(70),await x.action.setWidth(150))});function Z(l){const n=Ce.insertRow(0);n.className="data-row",n.id=je();const o=n.insertCell(0),h=n.insertCell(1);h.id="name_"+n.id,h.setAttribute("contenteditable","true"),h.innerHTML=l?l.Name:"Default Name";const v=n.insertCell(2);v.className="center";const b=rt();b.value=l?l.Group:"#1",b.id="group_"+n.id,v.appendChild(b);const c=n.insertCell(3);c.className="center";const f=at();f.value=l?l.Direction:"Top",f.id="selector_"+n.id,c.appendChild(f);const u=n.insertCell(4);u.id=n.id,u.className="center",o.innerHTML=`<input id="checkbox_${n.id}" type="checkbox" ${l?.Active===0?"":"checked"}/>`;const w=l?We(l.Color):void 0;u.appendChild(tt(u.id,w))}function tt(l,n){const o=document.createElement("div"),h=document.createElement("button");h.setAttribute("aria-labelledby","clr-open-label"),h.id="clr-button_"+l,o.className="clr-field",o.id="clr-field_"+l,o.style.color=n?"rgb"+n:"rgb(0, 0, 0)",o.appendChild(h);const v=document.createElement("input");return v.type="text",v.id="clr-input_"+l,v.style.width="20px",v.className="coloris",v.setAttribute("data-coloris",""),o.appendChild(v),o}function at(){const l=document.createElement("select");return["Top","Bottom","Left","Right"].forEach(o=>{const h=document.createElement("option");h.setAttribute("value",o);const v=document.createTextNode(o);h.appendChild(v),l.appendChild(h)}),l}function rt(){const l=document.createElement("select");return["#1","#2","#3"].forEach(o=>{const h=document.createElement("option");h.setAttribute("value",o);const v=document.createTextNode(o);h.appendChild(v),l.appendChild(h)}),l}async function nt(){const l=Le();var n=document.createElement("a"),o=new Blob([JSON.stringify(l)],{type:"text/plain"});n.href=URL.createObjectURL(o),n.download=`MarkedExport-${Date.now()}`,document.body.appendChild(n),n.click(),document.body.removeChild(n)}async function it(l){if(l&&l.Labels?.length>0){const n=document.getElementById("label-list");n.innerHTML="",l.Labels.forEach(o=>{Z(o)}),l.Groups.forEach(o=>{switch(o.Num){case"#1":ee.value=o.Name;break;case"#2":te.value=o.Name;break;case"#3":ae.value=o.Name;break;default:throw new Error("Invalid Group")}}),P.value=l.Distance,_.value=l.Opacity}await fe()}async function fe(){const l=Le();let n={};n[`${V.EXTENSIONID}/metadata_marks`]={saveData:l},await x.room.setMetadata(n)}function Le(){const l=[],n=[],o=P.value,h=_.value;for(var v=document.getElementById("label-list"),b=0,c;c=v.rows[b];b++){const f=c.id,u=c.querySelector("#checkbox_"+f),w=c.querySelector("#name_"+f),I=c.querySelector("#selector_"+f),F=c.querySelector("#group_"+f),T=c.querySelector("#clr-field_"+f),p=Xe(T.style.color),g={Id:f,Active:u.checked?1:0,Name:w.innerText.trim(),Direction:I.value,Color:p,Group:F.value};l.push(g)}return n.push({Name:ee.value,Num:"#1"}),n.push({Name:te.value,Num:"#2"}),n.push({Name:ae.value,Num:"#3"}),{Groups:n,Labels:l.reverse(),Distance:o,Opacity:h}}async function lt(){confirm("Erase everything and go back to default labels?")&&(Ce.innerHTML="",await Fe())}async function Fe(){ee.value=de[0],te.value=de[1],ae.value=de[2],P.value=ke,_.value=Ee,et.forEach(l=>{Z(l)}),await fe()}async function ot(){const o=(await x.room.getMetadata())[`${V.EXTENSIONID}/metadata_marks`]?.saveData;o&&o.Labels?.length>0?(o.Labels.forEach(p=>{Z(p)}),o.Groups.forEach(p=>{switch(p.Num){case"#1":ee.value=p.Name;break;case"#2":te.value=p.Name;break;case"#3":ae.value=p.Name;break;default:throw new Error("Invalid Group")}})):await Fe(),P.max="999",P.min="1",P.maxLength=4,P.value=o?.Distance?o.Distance:ke,P.oninput=p=>{I(p.target)},_.max="99",_.min="1",_.maxLength=2,_.value=o?.Opacity?o.Opacity:Ee,_.oninput=p=>{I(p.target)};const h=document.createElement("input");h.type="image",h.className="Icon clickable",h.id="exportButton",h.onclick=async function(){await nt()},h.src="/export.svg",h.title="Export Data",h.height=20,h.width=20,U.appendChild(h);const v=document.createElement("input");v.type="image",v.className="Icon clickable",v.id="importButton",v.onclick=async function(){document.getElementById("fileButton").click()},v.src="/import.svg",v.title="Import Data",v.height=20,v.width=20,U.appendChild(v);const b=document.createElement("input");b.type="file",b.id="fileButton",b.title="Choose a file to import",b.className="tinyType",b.hidden=!0,b.onchange=async function(){if(console.log("FILE ADDED"),b.files&&b.files.length>0){let p=b.files[0],g=new FileReader;g.readAsText(p),g.onload=async function(){try{const N=JSON.parse(g.result);await it(N),x.notification.show("Import Complete!","SUCCESS")}catch(N){x.notification.show(`The import failed - ${N}`,"ERROR")}},g.onerror=function(){console.log(g.error)}}},U.appendChild(b);const c=document.createElement("input");c.type="image",c.className="Icon clickable",c.id="saveButton",c.onclick=async function(){await fe()},c.src="/save.svg",c.title="Save Changes",c.height=20,c.width=20,U.appendChild(c);const f=document.createElement("input");f.type="image",f.className="Icon clickable",f.id="addButton",f.onclick=async function(){await Z()},f.src="/add.svg",f.title="Add Label",f.height=20,f.width=20,U.appendChild(f);const u=document.createElement("input");u.type="image",u.className="Icon clickable",u.id="addButton",u.onclick=async function(){await lt()},u.src="/reset.svg",u.title="Reset to Default Labels",u.height=20,u.width=20,U.appendChild(u),Ze.onclick=async function(){var p,g,N,L,S,E,M;for(p=document.getElementById("label-list"),N=!0;N;){for(N=!1,g=p.getElementsByClassName("data-row"),L=0;L<g.length-1;L++)if(M=!1,S=g[L].getElementsByTagName("td")[1],E=g[L+1].getElementsByTagName("td")[1],ue){if(S.innerHTML.toLowerCase()>E.innerHTML.toLowerCase()){M=!0;break}}else if(S.innerHTML.toLowerCase()<E.innerHTML.toLowerCase()){M=!0;break}M&&(g[L].parentNode.insertBefore(g[L+1],g[L]),N=!0)}ue=!ue},we.style.display="none",Qe.style.display="";function w(p){return parseInt(p)}function I(p){let g=p.min,N=p.max,L=w(p.value);L>N?p.value=N:L<g&&(p.value=g)}function F(p){p.preventDefault();const g=p.target.closest("tr");g&&g.rowIndex>0&&window.confirm(`Are you sure you want to delete ${g.children[1].innerHTML}?`)&&g.remove()}const T=document.getElementById("table-one");T&&T.addEventListener("contextmenu",F)}
