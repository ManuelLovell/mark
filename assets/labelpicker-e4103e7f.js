import{a as S,O as d,C as L,b as k,S as C}from"./style-b76273e9.js";class B{static async UpdateLabel(n,l,y,I){const g=S(n.id,l.Id),b=await d.scene.items.getItems([g]),T="#242424",f=parseInt(y),N=+I/100,a=n.grid.dpi/150;let s=0;if(b.length===0){const o=await d.scene.items.getItems(c=>c.attachedTo===n.id&&c.type==="LABEL"&&c.style.pointerDirection===i(l.Direction));if(o.length>0){for(let c=0;c<o.length+1;c++)if(!o.find(e=>e.metadata[`${L.EXTENSIONID}/place`].placement===c)){s=c;break}}let p={};p[`${L.EXTENSIONID}/place`]={placement:s};const t=k().fillColor(l.Color).plainText(l.Name).fillOpacity(N).build();t.id=g,t.type="LABEL",t.attachedTo=n.id,t.visible=!!n.visible,t.locked=!0,t.position={x:n.position.x,y:n.position.y},t.metadata=p,t.disableAttachmentBehavior=["ROTATION","SCALE"];let r,u=15,h=15;l.Direction=="Top"&&(t.position.y-=n.image.height*n.scale.y/4/a,r="DOWN",o.length>0&&s!==0&&(t.position.y-=15,t.position.y-=f*s)),l.Direction=="Bottom"&&(t.position.y+=n.image.height*n.scale.y/4/a,r="UP",o.length>0&&s!==0&&(t.position.y+=15,t.position.y+=f*s)),l.Direction=="Right"&&(t.position.x+=n.image.width*n.scale.x/4/a,r="LEFT",o.length>0&&s!==0&&(t.position.y+=f*s)),l.Direction=="Left"&&(t.position.x-=n.image.width*n.scale.x/4/a,r="RIGHT",o.length>0&&s!==0&&(t.position.y-=f*s)),o.length>0&&s!==0&&(u=0,h=0),t.style={backgroundColor:T,backgroundOpacity:N,pointerDirection:r,pointerWidth:h,pointerHeight:u,cornerRadius:10},await d.scene.items.addItems([t])}else await d.scene.items.deleteItems([g]);function i(o){switch(o){case"Top":return"DOWN";case"Bottom":return"UP";case"Right":return"LEFT";case"Left":return"RIGHT";default:throw new Error("Invalid direction")}}}}d.onReady(async()=>{document.documentElement.style.borderRadius="16px",document.documentElement.style.height="100%";const w=window.location.search,n=new URLSearchParams(w),l=n.get("targetid"),y=n.get("multi"),I=y?l.split(","):[];let g=[];const b=await d.scene.items.getItems(y?I:[l]);y||(g=await d.scene.items.getItems(i=>i.attachedTo===b[0].id&&i.type==="LABEL"));const T=await d.theme.getTheme();C(T,document),d.theme.onChange(i=>{C(i,document)});const a=(await d.room.getMetadata())[`${L.EXTENSIONID}/metadata_marks`]?.saveData;if(a&&a.Labels?.length>0){let i=function(e){e==="#1"?(o.style.display="",p.style.display="none",t.style.display="none"):e==="#2"?(o.style.display="none",p.style.display="",t.style.display="none"):(o.style.display="none",p.style.display="none",t.style.display="")};const o=document.querySelector("#label-list1"),p=document.querySelector("#label-list2"),t=document.querySelector("#label-list3"),r=document.createElement("button");r.className="categoryButton",r.onclick=()=>i("#1");const u=document.createElement("button");u.className="categoryButton",u.onclick=()=>i("#2");const h=document.createElement("button");h.className="categoryButton",h.onclick=()=>i("#3");const c=document.querySelector(".footered");c.appendChild(r),c.appendChild(u),c.appendChild(h),a.Groups.forEach(e=>{switch(e.Num){case"#1":r.innerText=e.Name;break;case"#2":u.innerText=e.Name;break;case"#3":h.innerText=e.Name;break;default:throw new Error("Invalid Group")}}),a.Labels.forEach(e=>{if(e.Active){const E=g.find(O=>O.text.plainText===e.Name),m=document.createElement("button");m.id=`toggle-${e.Id}`,m.className=`group1${E?" highlight":""}`,m.value=e.Name,m.title=e.Name,m.textContent=e.Name,e.Group==="#1"?o.appendChild(m):e.Group==="#2"?p.appendChild(m):t.appendChild(m)}}),document.querySelectorAll(".group1").forEach(e=>{e.addEventListener("click",async E=>await s(E.currentTarget))}),i("#1")}else document.querySelector("#label-list1").innerHTML=`
        <div>
        No labels found.
        </div>`;async function s(i){const o=i.id.substring(7),p=a.Labels.find(t=>t.Id===o);y||(i.className=i.className==="group1"?"group1 highlight":"group1"),b.forEach(async t=>{await B.UpdateLabel(t,p,a.Distance,a.Opacity)})}});
