import{a as L,O as m,C as b,b as k,S}from"./style-13eb9e98.js";class B{static async UpdateLabel(n,a,y,w){const E=L(n.id,a.Id),p=parseInt(y),g=p>48?36+p/3:36,v=+w/100,T=n.grid.dpi/150,u=p+"px Roboto",N=f(a.Name,u),i=x(a.Name,u);let s=0;const c=await m.scene.items.getItems(o=>o.attachedTo===n.id&&o.type==="TEXT"&&o.text.style.fontWeight===h(a.Direction)),d=c.find(o=>o.text.plainText===a.Name);if(d)await m.scene.items.deleteItems([d.id]);else{if(c.length>0){for(let e=0;e<c.length+1;e++)if(!c.find(r=>r.metadata[`${b.EXTENSIONID}/place`].placement===e)){s=e;break}}let o={};o[`${b.EXTENSIONID}/place`]={placement:s};const t=k().fillColor(a.Color).plainText(a.Name).fillOpacity(v).strokeWidth(1.75).strokeColor("black").strokeOpacity(1).build();t.id=E,t.type="TEXT",t.attachedTo=n.id,t.visible=!!n.visible,t.locked=!0,t.position={x:n.position.x,y:n.position.y},t.metadata=o,t.disableAttachmentBehavior=["ROTATION","SCALE"],t.text.style.fontWeight=h(a.Direction),t.text.type="PLAIN",t.text.style.fontSize=p,t.text.style.textAlign="CENTER",a.Direction=="Top"&&(t.position.y-=n.image.height*n.scale.y/4/T+n.image.height/4,c.length>0&&s!==0&&(t.position.y-=g*s)),a.Direction=="Bottom"&&(t.position.y-=n.image.height*n.scale.y/4/T-n.image.height/4,t.position.x-=N,c.length>0&&s!==0&&(t.position.y+=g*s)),a.Direction=="Right"&&(t.position.x+=n.image.width*n.scale.x/4/T,t.position.y-=i/2,c.length>0&&s!==0&&(t.position.y+=g*s)),a.Direction=="Left"&&(t.position.x-=n.image.width*n.scale.x/4/T,t.position.x-=N,t.position.y-=i/2,c.length>0&&s!==0&&(t.position.y-=g*s)),await m.scene.items.addItems([t])}function h(o){switch(o){case"Top":return 601;case"Bottom":return 602;case"Right":return 603;case"Left":return 604;default:throw new Error("Invalid direction")}}function f(o,t){const l=document.createElement("canvas").getContext("2d");if(!l)throw new Error("Canvas 2D context is not supported.");return l.font=t,l.measureText(o).width}function x(o,t){const l=document.createElement("canvas").getContext("2d");if(!l)throw new Error("Canvas 2D context is not supported.");l.font=t;const r=l.measureText(o);return r.actualBoundingBoxAscent+r.actualBoundingBoxDescent}}}m.onReady(async()=>{document.documentElement.style.borderRadius="16px",document.documentElement.style.height="100%";const C=window.location.search,n=new URLSearchParams(C),a=n.get("targetid"),y=n.get("multi"),w=y?a.split(","):[];let E=[];const p=await m.scene.items.getItems(y?w:[a]);y||(E=await m.scene.items.getItems(i=>i.attachedTo===p[0].id&&i.type==="TEXT"));const g=await m.theme.getTheme();S(g,document),m.theme.onChange(i=>{S(i,document)});const u=(await m.room.getMetadata())[`${b.EXTENSIONID}/metadata_marks`]?.saveData;if(u&&u.Labels?.length>0){let i=function(e){e==="#1"?(s.style.display="",c.style.display="none",d.style.display="none"):e==="#2"?(s.style.display="none",c.style.display="",d.style.display="none"):(s.style.display="none",c.style.display="none",d.style.display="")};const s=document.querySelector("#label-list1"),c=document.querySelector("#label-list2"),d=document.querySelector("#label-list3"),h=document.createElement("button");h.className="categoryButton",h.onclick=()=>i("#1");const f=document.createElement("button");f.className="categoryButton",f.onclick=()=>i("#2");const x=document.createElement("button");x.className="categoryButton",x.onclick=()=>i("#3");const o=document.querySelector(".footered");o.appendChild(h),o.appendChild(f),o.appendChild(x),u.Groups.forEach(e=>{switch(e.Num){case"#1":h.innerText=e.Name;break;case"#2":f.innerText=e.Name;break;case"#3":x.innerText=e.Name;break;default:throw new Error("Invalid Group")}}),u.Labels.forEach(e=>{if(e.Active){const l=E.find(I=>I.text.plainText===e.Name),r=document.createElement("button");r.id=`toggle-${e.Id}`,r.className=`group1${l?" highlight":""}`,r.value=e.Name,r.title=e.Name,r.textContent=e.Name,e.Group==="#1"?s.appendChild(r):e.Group==="#2"?c.appendChild(r):d.appendChild(r)}}),document.querySelectorAll(".group1").forEach(e=>{e.addEventListener("click",async l=>await N(l.currentTarget))}),i("#1")}else document.querySelector("#label-list1").innerHTML=`
        <div>
        No labels found.
        </div>`;async function N(i){const s=i.id.substring(7),c=u.Labels.find(d=>d.Id===s);y||(i.className=i.className==="group1"?"group1 highlight":"group1"),p.forEach(async d=>{await B.UpdateLabel(d,c,u.Distance,u.Opacity)})}});
