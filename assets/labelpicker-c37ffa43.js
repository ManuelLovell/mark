import{O as d,C as N,b as k}from"./constants-e2306cdc.js";import{b as B,C as O,S as L}from"./style-c0b8e8d0.js";class D{static async UpdateLabel(u,i,b,y){const E=await d.scene.grid.getDpi(),h=B(u,E),v=O(u.id,i.Id),f=parseInt(b),r=f>48?36+f/3:36,I=+y/100,o=f+"px Roboto",l=x(i.Name,o),a=C(i.Name,o);let n=0;const c=await d.scene.items.getItems(t=>t.attachedTo===u.id&&t.type==="TEXT"&&t.text.style.fontWeight===g(i.Direction)),p=c.find(t=>t.text.plainText===i.Name);if(p)await d.scene.items.deleteItems([p.id]);else{if(c.length>0){for(let s=0;s<c.length+1;s++)if(!c.find(T=>T.metadata[`${N.EXTENSIONID}/place`].placement===s)){n=s;break}}let t={};t[`${N.EXTENSIONID}/place`]={placement:n},t[`${N.EXTENSIONID}/comboid`]=v;const e=k().fillColor(i.Color).plainText(i.Name).fillOpacity(I).strokeWidth(1.75).strokeColor("black").strokeOpacity(1).build();e.type="TEXT",e.attachedTo=u.id,e.visible=!!u.visible,e.locked=!0,e.position={x:u.position.x,y:u.position.y},e.metadata=t,e.disableAttachmentBehavior=["ROTATION","SCALE"],e.text.style.fontWeight=g(i.Direction),e.text.type="PLAIN",e.text.style.fontSize=f,e.text.style.textAlign="CENTER",i.Direction=="Top"&&(e.position.y=h.min.y,e.position.y-=a,c.length>0&&n!==0&&(e.position.y-=r*n)),i.Direction=="Bottom"&&(e.position.y=h.max.y-a/2,e.position.x-=l,c.length>0&&n!==0&&(e.position.y+=r*n)),i.Direction=="Right"&&(e.position.x=h.max.x,e.position.y-=a/2,c.length>0&&n!==0&&(e.position.y+=r*n)),i.Direction=="Left"&&(e.position.x=h.min.x,e.position.x-=l,e.position.y-=a/2,c.length>0&&n!==0&&(e.position.y-=r*n)),await d.scene.items.addItems([e])}function g(t){switch(t){case"Top":return 601;case"Bottom":return 602;case"Right":return 603;case"Left":return 604;default:throw new Error("Invalid direction")}}function x(t,e){const m=document.createElement("canvas").getContext("2d");if(!m)throw new Error("Canvas 2D context is not supported.");return m.font=e,m.measureText(t).width}function C(t,e){const m=document.createElement("canvas").getContext("2d");if(!m)throw new Error("Canvas 2D context is not supported.");m.font=e;const T=m.measureText(t);return T.actualBoundingBoxAscent+T.actualBoundingBoxDescent}}}d.onReady(async()=>{document.documentElement.style.borderRadius="16px",document.documentElement.style.height="100%";const w=window.location.search,i=new URLSearchParams(w).get("contextmenu");let b=[];const y=await d.player.getSelection(),E=await d.scene.items.getItems(y);y?.length===1&&(b=await d.scene.items.getItems(o=>o.attachedTo===E[0].id&&o.type==="TEXT"));const h=await d.theme.getTheme();L(h,document),d.theme.onChange(o=>{L(o,document)});const r=(await d.room.getMetadata())[`${N.EXTENSIONID}/metadata_marks`]?.saveData;if(r&&r.Labels?.length>0){let o=function(t){t==="#1"?(l.style.display="",a.style.display="none",n.style.display="none"):t==="#2"?(l.style.display="none",a.style.display="",n.style.display="none"):(l.style.display="none",a.style.display="none",n.style.display="")};const l=document.querySelector("#label-list1"),a=document.querySelector("#label-list2"),n=document.querySelector("#label-list3"),c=document.createElement("button");c.className="categoryButton",c.onclick=()=>o("#1");const p=document.createElement("button");p.className="categoryButton",p.onclick=()=>o("#2");const g=document.createElement("button");g.className="categoryButton",g.onclick=()=>o("#3");const x=document.querySelector(".footered");x.appendChild(c),x.appendChild(p),x.appendChild(g),i&&(l.classList.remove("btn-group"),l.classList.add("context-btn-group"),a.classList.remove("btn-group"),a.classList.add("context-btn-group"),n.classList.remove("btn-group"),n.classList.add("context-btn-group")),r.Groups.forEach(t=>{switch(t.Num){case"#1":c.innerText=t.Name;break;case"#2":p.innerText=t.Name;break;case"#3":g.innerText=t.Name;break;default:throw new Error("Invalid Group")}}),r.Labels.forEach(t=>{if(t.Active){const e=b.find(m=>m.text.plainText===t.Name),s=document.createElement("button");s.id=`toggle-${t.Id}`,s.className=`group1${e?" highlight":""}`,s.value=t.Name,s.title=t.Name,s.textContent=t.Name,t.Group==="#1"?l.appendChild(s):t.Group==="#2"?a.appendChild(s):n.appendChild(s)}}),document.querySelectorAll(".group1").forEach(t=>{t.addEventListener("click",async e=>await I(e.currentTarget))}),o("#1")}else document.querySelector("#label-list1").innerHTML=`
        <div>
        No labels found.
        </div>`;async function I(o){const l=o.id.substring(7),a=r.Labels.find(n=>n.Id===l);y?.length===1&&(o.className=o.className==="group1"?"group1 highlight":"group1"),E.forEach(async n=>{await D.UpdateLabel(n,a,r.Distance,r.Opacity)})}});
