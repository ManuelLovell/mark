import{a as S,O as d,C as L,b as k,S as x}from"./style-b76273e9.js";class B{static async UpdateLabel(o,a,h,b){const T=S(o.id,a.Id),E="#242424",g=parseInt(h),I=+b/100,f=o.grid.dpi/150;let n=0;const c=await d.scene.items.getItems(i=>i.attachedTo===o.id&&i.type==="LABEL"&&i.style.pointerDirection===p(a.Direction)),s=c.find(i=>i.text.plainText===a.Name);if(s)await d.scene.items.deleteItems([s.id]);else{if(c.length>0){for(let m=0;m<c.length+1;m++)if(!c.find(e=>e.metadata[`${L.EXTENSIONID}/place`].placement===m)){n=m;break}}let i={};i[`${L.EXTENSIONID}/place`]={placement:n};const t=k().fillColor(a.Color).plainText(a.Name).fillOpacity(I).build();t.id=T,t.type="LABEL",t.attachedTo=o.id,t.visible=!!o.visible,t.locked=!0,t.position={x:o.position.x,y:o.position.y},t.metadata=i,t.disableAttachmentBehavior=["ROTATION","SCALE"];let l,u=15,y=15;a.Direction=="Top"&&(t.position.y-=o.image.height*o.scale.y/4/f,l="DOWN",c.length>0&&n!==0&&(t.position.y-=15,t.position.y-=g*n)),a.Direction=="Bottom"&&(t.position.y+=o.image.height*o.scale.y/4/f,l="UP",c.length>0&&n!==0&&(t.position.y+=15,t.position.y+=g*n)),a.Direction=="Right"&&(t.position.x+=o.image.width*o.scale.x/4/f,l="LEFT",c.length>0&&n!==0&&(t.position.y+=g*n)),a.Direction=="Left"&&(t.position.x-=o.image.width*o.scale.x/4/f,l="RIGHT",c.length>0&&n!==0&&(t.position.y-=g*n)),c.length>0&&n!==0&&(u=0,y=0),t.style={backgroundColor:E,backgroundOpacity:I,pointerDirection:l,pointerWidth:y,pointerHeight:u,cornerRadius:10},await d.scene.items.addItems([t])}function p(i){switch(i){case"Top":return"DOWN";case"Bottom":return"UP";case"Right":return"LEFT";case"Left":return"RIGHT";default:throw new Error("Invalid direction")}}}}d.onReady(async()=>{document.documentElement.style.borderRadius="16px",document.documentElement.style.height="100%";const w=window.location.search,o=new URLSearchParams(w),a=o.get("targetid"),h=o.get("multi"),b=h?a.split(","):[];let T=[];const E=await d.scene.items.getItems(h?b:[a]);h||(T=await d.scene.items.getItems(s=>s.attachedTo===E[0].id&&s.type==="LABEL"));const g=await d.theme.getTheme();x(g,document),d.theme.onChange(s=>{x(s,document)});const n=(await d.room.getMetadata())[`${L.EXTENSIONID}/metadata_marks`]?.saveData;if(n&&n.Labels?.length>0){let s=function(e){e==="#1"?(p.style.display="",i.style.display="none",t.style.display="none"):e==="#2"?(p.style.display="none",i.style.display="",t.style.display="none"):(p.style.display="none",i.style.display="none",t.style.display="")};const p=document.querySelector("#label-list1"),i=document.querySelector("#label-list2"),t=document.querySelector("#label-list3"),l=document.createElement("button");l.className="categoryButton",l.onclick=()=>s("#1");const u=document.createElement("button");u.className="categoryButton",u.onclick=()=>s("#2");const y=document.createElement("button");y.className="categoryButton",y.onclick=()=>s("#3");const m=document.querySelector(".footered");m.appendChild(l),m.appendChild(u),m.appendChild(y),n.Groups.forEach(e=>{switch(e.Num){case"#1":l.innerText=e.Name;break;case"#2":u.innerText=e.Name;break;case"#3":y.innerText=e.Name;break;default:throw new Error("Invalid Group")}}),n.Labels.forEach(e=>{if(e.Active){const N=T.find(O=>O.text.plainText===e.Name),r=document.createElement("button");r.id=`toggle-${e.Id}`,r.className=`group1${N?" highlight":""}`,r.value=e.Name,r.title=e.Name,r.textContent=e.Name,e.Group==="#1"?p.appendChild(r):e.Group==="#2"?i.appendChild(r):t.appendChild(r)}}),document.querySelectorAll(".group1").forEach(e=>{e.addEventListener("click",async N=>await c(N.currentTarget))}),s("#1")}else document.querySelector("#label-list1").innerHTML=`
        <div>
        No labels found.
        </div>`;async function c(s){const p=s.id.substring(7),i=n.Labels.find(t=>t.Id===p);h||(s.className=s.className==="group1"?"group1 highlight":"group1"),E.forEach(async t=>{await B.UpdateLabel(t,i,n.Distance,n.Opacity)})}});
