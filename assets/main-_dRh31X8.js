import{O as $,C as z,i as Br,L as Nr,S as Wt,a as Rr,G as Mr,b as Hr,c as Pr,H as $r,R as jr}from"./style-Dvcb6zg2.js";function Fr(e){return e.type==="IMAGE"}const Ur="com.battle-system.mark-menu";function Vr(){$.contextMenu.create({id:`${Ur}/context-menu`,icons:[{icon:"/tag1.svg",label:"Mark It",filter:{some:[{key:"layer",value:"CHARACTER",coordinator:"||"},{key:"layer",value:"MOUNT"}]}}],async onClick(e,t){await $.popover.open({id:z.LABELSID,url:"/labelpicker.html",height:250,width:300,anchorElementId:t})},embed:{url:"/labelpicker.html?contextmenu=true",height:200}})}function Wr(){$.broadcast.onMessage(z.MARKCONNECT,async e=>{if(Array.isArray(e.data)){const t=e.data;if(t.length>0){const r=await $.room.getMetadata(),a=await $.scene.items.getItems(l=>Fr(l)),u=r[`${z.EXTENSIONID}/metadata_marks`]?.saveData;let s=u.Distance??"36",p=u.Opacity??"85";for(const l of t){const h={Active:1,Direction:l.Direction??"Top",Color:Br(l.Color)?l.Color:"#FFFFFF",Group:"#1",Name:l.LabelName,Id:`TID-${l.LabelName}`,Counter:0},v=u.Labels.find(C=>C.Name?.toLowerCase().includes(l.LabelName?.toLowerCase()));v&&(h.Name=v.Name,h.Direction=v.Direction,h.Color=v.Color,h.Id=v.Id);const A=a.find(C=>C.id===l.TokenId);A&&await Nr.UpdateLabel(A,h,s,p,z.DEFAULTSTROKE,l.Show)}}}})}var ne="top",pe="bottom",de="right",ae="left",Nt="auto",ot=[ne,pe,de,ae],Ke="start",at="end",Gr="clippingParents",cr="viewport",et="popper",qr="reference",Gt=ot.reduce(function(e,t){return e.concat([t+"-"+Ke,t+"-"+at])},[]),ur=[].concat(ot,[Nt]).reduce(function(e,t){return e.concat([t,t+"-"+Ke,t+"-"+at])},[]),Xr="beforeRead",_r="read",Yr="afterRead",zr="beforeMain",Kr="main",Jr="afterMain",Zr="beforeWrite",Qr="write",en="afterWrite",tn=[Xr,_r,Yr,zr,Kr,Jr,Zr,Qr,en];function Te(e){return e?(e.nodeName||"").toLowerCase():null}function oe(e){if(e==null)return window;if(e.toString()!=="[object Window]"){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function je(e){var t=oe(e).Element;return e instanceof t||e instanceof Element}function fe(e){var t=oe(e).HTMLElement;return e instanceof t||e instanceof HTMLElement}function Rt(e){if(typeof ShadowRoot>"u")return!1;var t=oe(e).ShadowRoot;return e instanceof t||e instanceof ShadowRoot}function rn(e){var t=e.state;Object.keys(t.elements).forEach(function(r){var a=t.styles[r]||{},i=t.attributes[r]||{},u=t.elements[r];!fe(u)||!Te(u)||(Object.assign(u.style,a),Object.keys(i).forEach(function(s){var p=i[s];p===!1?u.removeAttribute(s):u.setAttribute(s,p===!0?"":p)}))})}function nn(e){var t=e.state,r={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,r.popper),t.styles=r,t.elements.arrow&&Object.assign(t.elements.arrow.style,r.arrow),function(){Object.keys(t.elements).forEach(function(a){var i=t.elements[a],u=t.attributes[a]||{},s=Object.keys(t.styles.hasOwnProperty(a)?t.styles[a]:r[a]),p=s.reduce(function(l,h){return l[h]="",l},{});!fe(i)||!Te(i)||(Object.assign(i.style,p),Object.keys(u).forEach(function(l){i.removeAttribute(l)}))})}}const fr={name:"applyStyles",enabled:!0,phase:"write",fn:rn,effect:nn,requires:["computeStyles"]};function xe(e){return e.split("-")[0]}var $e=Math.max,vt=Math.min,Je=Math.round;function Dt(){var e=navigator.userAgentData;return e!=null&&e.brands&&Array.isArray(e.brands)?e.brands.map(function(t){return t.brand+"/"+t.version}).join(" "):navigator.userAgent}function pr(){return!/^((?!chrome|android).)*safari/i.test(Dt())}function Ze(e,t,r){t===void 0&&(t=!1),r===void 0&&(r=!1);var a=e.getBoundingClientRect(),i=1,u=1;t&&fe(e)&&(i=e.offsetWidth>0&&Je(a.width)/e.offsetWidth||1,u=e.offsetHeight>0&&Je(a.height)/e.offsetHeight||1);var s=je(e)?oe(e):window,p=s.visualViewport,l=!pr()&&r,h=(a.left+(l&&p?p.offsetLeft:0))/i,v=(a.top+(l&&p?p.offsetTop:0))/u,A=a.width/i,C=a.height/u;return{width:A,height:C,top:v,right:h+A,bottom:v+C,left:h,x:h,y:v}}function Mt(e){var t=Ze(e),r=e.offsetWidth,a=e.offsetHeight;return Math.abs(t.width-r)<=1&&(r=t.width),Math.abs(t.height-a)<=1&&(a=t.height),{x:e.offsetLeft,y:e.offsetTop,width:r,height:a}}function dr(e,t){var r=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(r&&Rt(r)){var a=t;do{if(a&&e.isSameNode(a))return!0;a=a.parentNode||a.host}while(a)}return!1}function Ae(e){return oe(e).getComputedStyle(e)}function an(e){return["table","td","th"].indexOf(Te(e))>=0}function Se(e){return((je(e)?e.ownerDocument:e.document)||window.document).documentElement}function gt(e){return Te(e)==="html"?e:e.assignedSlot||e.parentNode||(Rt(e)?e.host:null)||Se(e)}function qt(e){return!fe(e)||Ae(e).position==="fixed"?null:e.offsetParent}function on(e){var t=/firefox/i.test(Dt()),r=/Trident/i.test(Dt());if(r&&fe(e)){var a=Ae(e);if(a.position==="fixed")return null}var i=gt(e);for(Rt(i)&&(i=i.host);fe(i)&&["html","body"].indexOf(Te(i))<0;){var u=Ae(i);if(u.transform!=="none"||u.perspective!=="none"||u.contain==="paint"||["transform","perspective"].indexOf(u.willChange)!==-1||t&&u.willChange==="filter"||t&&u.filter&&u.filter!=="none")return i;i=i.parentNode}return null}function st(e){for(var t=oe(e),r=qt(e);r&&an(r)&&Ae(r).position==="static";)r=qt(r);return r&&(Te(r)==="html"||Te(r)==="body"&&Ae(r).position==="static")?t:r||on(e)||t}function Ht(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function tt(e,t,r){return $e(e,vt(t,r))}function sn(e,t,r){var a=tt(e,t,r);return a>r?r:a}function vr(){return{top:0,right:0,bottom:0,left:0}}function mr(e){return Object.assign({},vr(),e)}function hr(e,t){return t.reduce(function(r,a){return r[a]=e,r},{})}var ln=function(t,r){return t=typeof t=="function"?t(Object.assign({},r.rects,{placement:r.placement})):t,mr(typeof t!="number"?t:hr(t,ot))};function cn(e){var t,r=e.state,a=e.name,i=e.options,u=r.elements.arrow,s=r.modifiersData.popperOffsets,p=xe(r.placement),l=Ht(p),h=[ae,de].indexOf(p)>=0,v=h?"height":"width";if(!(!u||!s)){var A=ln(i.padding,r),C=Mt(u),g=l==="y"?ne:ae,w=l==="y"?pe:de,T=r.rects.reference[v]+r.rects.reference[l]-s[l]-r.rects.popper[v],E=s[l]-r.rects.reference[l],k=st(u),L=k?l==="y"?k.clientHeight||0:k.clientWidth||0:0,R=T/2-E/2,o=A[g],N=L-C[v]-A[w],f=L/2-C[v]/2+R,M=tt(o,f,N),G=l;r.modifiersData[a]=(t={},t[G]=M,t.centerOffset=M-f,t)}}function un(e){var t=e.state,r=e.options,a=r.element,i=a===void 0?"[data-popper-arrow]":a;i!=null&&(typeof i=="string"&&(i=t.elements.popper.querySelector(i),!i)||dr(t.elements.popper,i)&&(t.elements.arrow=i))}const fn={name:"arrow",enabled:!0,phase:"main",fn:cn,effect:un,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Qe(e){return e.split("-")[1]}var pn={top:"auto",right:"auto",bottom:"auto",left:"auto"};function dn(e,t){var r=e.x,a=e.y,i=t.devicePixelRatio||1;return{x:Je(r*i)/i||0,y:Je(a*i)/i||0}}function Xt(e){var t,r=e.popper,a=e.popperRect,i=e.placement,u=e.variation,s=e.offsets,p=e.position,l=e.gpuAcceleration,h=e.adaptive,v=e.roundOffsets,A=e.isFixed,C=s.x,g=C===void 0?0:C,w=s.y,T=w===void 0?0:w,E=typeof v=="function"?v({x:g,y:T}):{x:g,y:T};g=E.x,T=E.y;var k=s.hasOwnProperty("x"),L=s.hasOwnProperty("y"),R=ae,o=ne,N=window;if(h){var f=st(r),M="clientHeight",G="clientWidth";if(f===oe(r)&&(f=Se(r),Ae(f).position!=="static"&&p==="absolute"&&(M="scrollHeight",G="scrollWidth")),f=f,i===ne||(i===ae||i===de)&&u===at){o=pe;var j=A&&f===N&&N.visualViewport?N.visualViewport.height:f[M];T-=j-a.height,T*=l?1:-1}if(i===ae||(i===ne||i===pe)&&u===at){R=de;var P=A&&f===N&&N.visualViewport?N.visualViewport.width:f[G];g-=P-a.width,g*=l?1:-1}}var U=Object.assign({position:p},h&&pn),V=v===!0?dn({x:g,y:T},oe(r)):{x:g,y:T};if(g=V.x,T=V.y,l){var F;return Object.assign({},U,(F={},F[o]=L?"0":"",F[R]=k?"0":"",F.transform=(N.devicePixelRatio||1)<=1?"translate("+g+"px, "+T+"px)":"translate3d("+g+"px, "+T+"px, 0)",F))}return Object.assign({},U,(t={},t[o]=L?T+"px":"",t[R]=k?g+"px":"",t.transform="",t))}function vn(e){var t=e.state,r=e.options,a=r.gpuAcceleration,i=a===void 0?!0:a,u=r.adaptive,s=u===void 0?!0:u,p=r.roundOffsets,l=p===void 0?!0:p,h={placement:xe(t.placement),variation:Qe(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:i,isFixed:t.options.strategy==="fixed"};t.modifiersData.popperOffsets!=null&&(t.styles.popper=Object.assign({},t.styles.popper,Xt(Object.assign({},h,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:s,roundOffsets:l})))),t.modifiersData.arrow!=null&&(t.styles.arrow=Object.assign({},t.styles.arrow,Xt(Object.assign({},h,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})}const mn={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:vn,data:{}};var ft={passive:!0};function hn(e){var t=e.state,r=e.instance,a=e.options,i=a.scroll,u=i===void 0?!0:i,s=a.resize,p=s===void 0?!0:s,l=oe(t.elements.popper),h=[].concat(t.scrollParents.reference,t.scrollParents.popper);return u&&h.forEach(function(v){v.addEventListener("scroll",r.update,ft)}),p&&l.addEventListener("resize",r.update,ft),function(){u&&h.forEach(function(v){v.removeEventListener("scroll",r.update,ft)}),p&&l.removeEventListener("resize",r.update,ft)}}const gn={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:hn,data:{}};var yn={left:"right",right:"left",bottom:"top",top:"bottom"};function dt(e){return e.replace(/left|right|bottom|top/g,function(t){return yn[t]})}var bn={start:"end",end:"start"};function _t(e){return e.replace(/start|end/g,function(t){return bn[t]})}function Pt(e){var t=oe(e),r=t.pageXOffset,a=t.pageYOffset;return{scrollLeft:r,scrollTop:a}}function $t(e){return Ze(Se(e)).left+Pt(e).scrollLeft}function wn(e,t){var r=oe(e),a=Se(e),i=r.visualViewport,u=a.clientWidth,s=a.clientHeight,p=0,l=0;if(i){u=i.width,s=i.height;var h=pr();(h||!h&&t==="fixed")&&(p=i.offsetLeft,l=i.offsetTop)}return{width:u,height:s,x:p+$t(e),y:l}}function En(e){var t,r=Se(e),a=Pt(e),i=(t=e.ownerDocument)==null?void 0:t.body,u=$e(r.scrollWidth,r.clientWidth,i?i.scrollWidth:0,i?i.clientWidth:0),s=$e(r.scrollHeight,r.clientHeight,i?i.scrollHeight:0,i?i.clientHeight:0),p=-a.scrollLeft+$t(e),l=-a.scrollTop;return Ae(i||r).direction==="rtl"&&(p+=$e(r.clientWidth,i?i.clientWidth:0)-u),{width:u,height:s,x:p,y:l}}function jt(e){var t=Ae(e),r=t.overflow,a=t.overflowX,i=t.overflowY;return/auto|scroll|overlay|hidden/.test(r+i+a)}function gr(e){return["html","body","#document"].indexOf(Te(e))>=0?e.ownerDocument.body:fe(e)&&jt(e)?e:gr(gt(e))}function rt(e,t){var r;t===void 0&&(t=[]);var a=gr(e),i=a===((r=e.ownerDocument)==null?void 0:r.body),u=oe(a),s=i?[u].concat(u.visualViewport||[],jt(a)?a:[]):a,p=t.concat(s);return i?p:p.concat(rt(gt(s)))}function St(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function xn(e,t){var r=Ze(e,!1,t==="fixed");return r.top=r.top+e.clientTop,r.left=r.left+e.clientLeft,r.bottom=r.top+e.clientHeight,r.right=r.left+e.clientWidth,r.width=e.clientWidth,r.height=e.clientHeight,r.x=r.left,r.y=r.top,r}function Yt(e,t,r){return t===cr?St(wn(e,r)):je(t)?xn(t,r):St(En(Se(e)))}function Tn(e){var t=rt(gt(e)),r=["absolute","fixed"].indexOf(Ae(e).position)>=0,a=r&&fe(e)?st(e):e;return je(a)?t.filter(function(i){return je(i)&&dr(i,a)&&Te(i)!=="body"}):[]}function An(e,t,r,a){var i=t==="clippingParents"?Tn(e):[].concat(t),u=[].concat(i,[r]),s=u[0],p=u.reduce(function(l,h){var v=Yt(e,h,a);return l.top=$e(v.top,l.top),l.right=vt(v.right,l.right),l.bottom=vt(v.bottom,l.bottom),l.left=$e(v.left,l.left),l},Yt(e,s,a));return p.width=p.right-p.left,p.height=p.bottom-p.top,p.x=p.left,p.y=p.top,p}function yr(e){var t=e.reference,r=e.element,a=e.placement,i=a?xe(a):null,u=a?Qe(a):null,s=t.x+t.width/2-r.width/2,p=t.y+t.height/2-r.height/2,l;switch(i){case ne:l={x:s,y:t.y-r.height};break;case pe:l={x:s,y:t.y+t.height};break;case de:l={x:t.x+t.width,y:p};break;case ae:l={x:t.x-r.width,y:p};break;default:l={x:t.x,y:t.y}}var h=i?Ht(i):null;if(h!=null){var v=h==="y"?"height":"width";switch(u){case Ke:l[h]=l[h]-(t[v]/2-r[v]/2);break;case at:l[h]=l[h]+(t[v]/2-r[v]/2);break}}return l}function it(e,t){t===void 0&&(t={});var r=t,a=r.placement,i=a===void 0?e.placement:a,u=r.strategy,s=u===void 0?e.strategy:u,p=r.boundary,l=p===void 0?Gr:p,h=r.rootBoundary,v=h===void 0?cr:h,A=r.elementContext,C=A===void 0?et:A,g=r.altBoundary,w=g===void 0?!1:g,T=r.padding,E=T===void 0?0:T,k=mr(typeof E!="number"?E:hr(E,ot)),L=C===et?qr:et,R=e.rects.popper,o=e.elements[w?L:C],N=An(je(o)?o:o.contextElement||Se(e.elements.popper),l,v,s),f=Ze(e.elements.reference),M=yr({reference:f,element:R,placement:i}),G=St(Object.assign({},R,M)),j=C===et?G:f,P={top:N.top-j.top+k.top,bottom:j.bottom-N.bottom+k.bottom,left:N.left-j.left+k.left,right:j.right-N.right+k.right},U=e.modifiersData.offset;if(C===et&&U){var V=U[i];Object.keys(P).forEach(function(F){var ee=[de,pe].indexOf(F)>=0?1:-1,J=[ne,pe].indexOf(F)>=0?"y":"x";P[F]+=V[J]*ee})}return P}function On(e,t){t===void 0&&(t={});var r=t,a=r.placement,i=r.boundary,u=r.rootBoundary,s=r.padding,p=r.flipVariations,l=r.allowedAutoPlacements,h=l===void 0?ur:l,v=Qe(a),A=v?p?Gt:Gt.filter(function(w){return Qe(w)===v}):ot,C=A.filter(function(w){return h.indexOf(w)>=0});C.length===0&&(C=A);var g=C.reduce(function(w,T){return w[T]=it(e,{placement:T,boundary:i,rootBoundary:u,padding:s})[xe(T)],w},{});return Object.keys(g).sort(function(w,T){return g[w]-g[T]})}function Cn(e){if(xe(e)===Nt)return[];var t=dt(e);return[_t(e),t,_t(t)]}function Ln(e){var t=e.state,r=e.options,a=e.name;if(!t.modifiersData[a]._skip){for(var i=r.mainAxis,u=i===void 0?!0:i,s=r.altAxis,p=s===void 0?!0:s,l=r.fallbackPlacements,h=r.padding,v=r.boundary,A=r.rootBoundary,C=r.altBoundary,g=r.flipVariations,w=g===void 0?!0:g,T=r.allowedAutoPlacements,E=t.options.placement,k=xe(E),L=k===E,R=l||(L||!w?[dt(E)]:Cn(E)),o=[E].concat(R).reduce(function(se,ie){return se.concat(xe(ie)===Nt?On(t,{placement:ie,boundary:v,rootBoundary:A,padding:h,flipVariations:w,allowedAutoPlacements:T}):ie)},[]),N=t.rects.reference,f=t.rects.popper,M=new Map,G=!0,j=o[0],P=0;P<o.length;P++){var U=o[P],V=xe(U),F=Qe(U)===Ke,ee=[ne,pe].indexOf(V)>=0,J=ee?"width":"height",Y=it(t,{placement:U,boundary:v,rootBoundary:A,altBoundary:C,padding:h}),X=ee?F?de:ae:F?pe:ne;N[J]>f[J]&&(X=dt(X));var _=dt(X),Z=[];if(u&&Z.push(Y[V]<=0),p&&Z.push(Y[X]<=0,Y[_]<=0),Z.every(function(se){return se})){j=U,G=!1;break}M.set(U,Z)}if(G)for(var te=w?3:1,ve=function(ie){var Q=o.find(function(Oe){var le=M.get(Oe);if(le)return le.slice(0,ie).every(function(me){return me})});if(Q)return j=Q,"break"},K=te;K>0;K--){var be=ve(K);if(be==="break")break}t.placement!==j&&(t.modifiersData[a]._skip=!0,t.placement=j,t.reset=!0)}}const kn={name:"flip",enabled:!0,phase:"main",fn:Ln,requiresIfExists:["offset"],data:{_skip:!1}};function zt(e,t,r){return r===void 0&&(r={x:0,y:0}),{top:e.top-t.height-r.y,right:e.right-t.width+r.x,bottom:e.bottom-t.height+r.y,left:e.left-t.width-r.x}}function Kt(e){return[ne,de,pe,ae].some(function(t){return e[t]>=0})}function Dn(e){var t=e.state,r=e.name,a=t.rects.reference,i=t.rects.popper,u=t.modifiersData.preventOverflow,s=it(t,{elementContext:"reference"}),p=it(t,{altBoundary:!0}),l=zt(s,a),h=zt(p,i,u),v=Kt(l),A=Kt(h);t.modifiersData[r]={referenceClippingOffsets:l,popperEscapeOffsets:h,isReferenceHidden:v,hasPopperEscaped:A},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":v,"data-popper-escaped":A})}const Sn={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:Dn};function In(e,t,r){var a=xe(e),i=[ae,ne].indexOf(a)>=0?-1:1,u=typeof r=="function"?r(Object.assign({},t,{placement:e})):r,s=u[0],p=u[1];return s=s||0,p=(p||0)*i,[ae,de].indexOf(a)>=0?{x:p,y:s}:{x:s,y:p}}function Bn(e){var t=e.state,r=e.options,a=e.name,i=r.offset,u=i===void 0?[0,0]:i,s=ur.reduce(function(v,A){return v[A]=In(A,t.rects,u),v},{}),p=s[t.placement],l=p.x,h=p.y;t.modifiersData.popperOffsets!=null&&(t.modifiersData.popperOffsets.x+=l,t.modifiersData.popperOffsets.y+=h),t.modifiersData[a]=s}const Nn={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:Bn};function Rn(e){var t=e.state,r=e.name;t.modifiersData[r]=yr({reference:t.rects.reference,element:t.rects.popper,placement:t.placement})}const Mn={name:"popperOffsets",enabled:!0,phase:"read",fn:Rn,data:{}};function Hn(e){return e==="x"?"y":"x"}function Pn(e){var t=e.state,r=e.options,a=e.name,i=r.mainAxis,u=i===void 0?!0:i,s=r.altAxis,p=s===void 0?!1:s,l=r.boundary,h=r.rootBoundary,v=r.altBoundary,A=r.padding,C=r.tether,g=C===void 0?!0:C,w=r.tetherOffset,T=w===void 0?0:w,E=it(t,{boundary:l,rootBoundary:h,padding:A,altBoundary:v}),k=xe(t.placement),L=Qe(t.placement),R=!L,o=Ht(k),N=Hn(o),f=t.modifiersData.popperOffsets,M=t.rects.reference,G=t.rects.popper,j=typeof T=="function"?T(Object.assign({},t.rects,{placement:t.placement})):T,P=typeof j=="number"?{mainAxis:j,altAxis:j}:Object.assign({mainAxis:0,altAxis:0},j),U=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,V={x:0,y:0};if(f){if(u){var F,ee=o==="y"?ne:ae,J=o==="y"?pe:de,Y=o==="y"?"height":"width",X=f[o],_=X+E[ee],Z=X-E[J],te=g?-G[Y]/2:0,ve=L===Ke?M[Y]:G[Y],K=L===Ke?-G[Y]:-M[Y],be=t.elements.arrow,se=g&&be?Mt(be):{width:0,height:0},ie=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:vr(),Q=ie[ee],Oe=ie[J],le=tt(0,M[Y],se[Y]),me=R?M[Y]/2-te-le-Q-P.mainAxis:ve-le-Q-P.mainAxis,we=R?-M[Y]/2+te+le+Oe+P.mainAxis:K+le+Oe+P.mainAxis,Ce=t.elements.arrow&&st(t.elements.arrow),Fe=Ce?o==="y"?Ce.clientTop||0:Ce.clientLeft||0:0,Ie=(F=U?.[o])!=null?F:0,Ue=X+me-Ie-Fe,Ve=X+we-Ie,Be=tt(g?vt(_,Ue):_,X,g?$e(Z,Ve):Z);f[o]=Be,V[o]=Be-X}if(p){var Ne,We=o==="x"?ne:ae,Ge=o==="x"?pe:de,ce=f[N],q=N==="y"?"height":"width",H=ce+E[We],he=ce-E[Ge],Re=[ne,ae].indexOf(k)!==-1,Le=(Ne=U?.[N])!=null?Ne:0,n=Re?H:ce-M[q]-G[q]-Le+P.altAxis,d=Re?ce+M[q]+G[q]-Le-P.altAxis:he,m=g&&Re?sn(n,ce,d):tt(g?n:H,ce,g?d:he);f[N]=m,V[N]=m-ce}t.modifiersData[a]=V}}const $n={name:"preventOverflow",enabled:!0,phase:"main",fn:Pn,requiresIfExists:["offset"]};function jn(e){return{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}}function Fn(e){return e===oe(e)||!fe(e)?Pt(e):jn(e)}function Un(e){var t=e.getBoundingClientRect(),r=Je(t.width)/e.offsetWidth||1,a=Je(t.height)/e.offsetHeight||1;return r!==1||a!==1}function Vn(e,t,r){r===void 0&&(r=!1);var a=fe(t),i=fe(t)&&Un(t),u=Se(t),s=Ze(e,i,r),p={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(a||!a&&!r)&&((Te(t)!=="body"||jt(u))&&(p=Fn(t)),fe(t)?(l=Ze(t,!0),l.x+=t.clientLeft,l.y+=t.clientTop):u&&(l.x=$t(u))),{x:s.left+p.scrollLeft-l.x,y:s.top+p.scrollTop-l.y,width:s.width,height:s.height}}function Wn(e){var t=new Map,r=new Set,a=[];e.forEach(function(u){t.set(u.name,u)});function i(u){r.add(u.name);var s=[].concat(u.requires||[],u.requiresIfExists||[]);s.forEach(function(p){if(!r.has(p)){var l=t.get(p);l&&i(l)}}),a.push(u)}return e.forEach(function(u){r.has(u.name)||i(u)}),a}function Gn(e){var t=Wn(e);return tn.reduce(function(r,a){return r.concat(t.filter(function(i){return i.phase===a}))},[])}function qn(e){var t;return function(){return t||(t=new Promise(function(r){Promise.resolve().then(function(){t=void 0,r(e())})})),t}}function Xn(e){var t=e.reduce(function(r,a){var i=r[a.name];return r[a.name]=i?Object.assign({},i,a,{options:Object.assign({},i.options,a.options),data:Object.assign({},i.data,a.data)}):a,r},{});return Object.keys(t).map(function(r){return t[r]})}var Jt={placement:"bottom",modifiers:[],strategy:"absolute"};function Zt(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return!t.some(function(a){return!(a&&typeof a.getBoundingClientRect=="function")})}function _n(e){e===void 0&&(e={});var t=e,r=t.defaultModifiers,a=r===void 0?[]:r,i=t.defaultOptions,u=i===void 0?Jt:i;return function(p,l,h){h===void 0&&(h=u);var v={placement:"bottom",orderedModifiers:[],options:Object.assign({},Jt,u),modifiersData:{},elements:{reference:p,popper:l},attributes:{},styles:{}},A=[],C=!1,g={state:v,setOptions:function(k){var L=typeof k=="function"?k(v.options):k;T(),v.options=Object.assign({},u,v.options,L),v.scrollParents={reference:je(p)?rt(p):p.contextElement?rt(p.contextElement):[],popper:rt(l)};var R=Gn(Xn([].concat(a,v.options.modifiers)));return v.orderedModifiers=R.filter(function(o){return o.enabled}),w(),g.update()},forceUpdate:function(){if(!C){var k=v.elements,L=k.reference,R=k.popper;if(Zt(L,R)){v.rects={reference:Vn(L,st(R),v.options.strategy==="fixed"),popper:Mt(R)},v.reset=!1,v.placement=v.options.placement,v.orderedModifiers.forEach(function(P){return v.modifiersData[P.name]=Object.assign({},P.data)});for(var o=0;o<v.orderedModifiers.length;o++){if(v.reset===!0){v.reset=!1,o=-1;continue}var N=v.orderedModifiers[o],f=N.fn,M=N.options,G=M===void 0?{}:M,j=N.name;typeof f=="function"&&(v=f({state:v,options:G,name:j,instance:g})||v)}}}},update:qn(function(){return new Promise(function(E){g.forceUpdate(),E(v)})}),destroy:function(){T(),C=!0}};if(!Zt(p,l))return g;g.setOptions(h).then(function(E){!C&&h.onFirstUpdate&&h.onFirstUpdate(E)});function w(){v.orderedModifiers.forEach(function(E){var k=E.name,L=E.options,R=L===void 0?{}:L,o=E.effect;if(typeof o=="function"){var N=o({state:v,name:k,instance:g,options:R}),f=function(){};A.push(N||f)}})}function T(){A.forEach(function(E){return E()}),A=[]}return g}}var Yn=[gn,Mn,mn,fr,Nn,kn,$n,fn,Sn],zn=_n({defaultModifiers:Yn}),Kn="tippy-box",br="tippy-content",Jn="tippy-backdrop",wr="tippy-arrow",Er="tippy-svg-arrow",He={passive:!0,capture:!0},xr=function(){return document.body};function At(e,t,r){if(Array.isArray(e)){var a=e[t];return a??(Array.isArray(r)?r[t]:r)}return e}function Ft(e,t){var r={}.toString.call(e);return r.indexOf("[object")===0&&r.indexOf(t+"]")>-1}function Tr(e,t){return typeof e=="function"?e.apply(void 0,t):e}function Qt(e,t){if(t===0)return e;var r;return function(a){clearTimeout(r),r=setTimeout(function(){e(a)},t)}}function Zn(e){return e.split(/\s+/).filter(Boolean)}function ze(e){return[].concat(e)}function er(e,t){e.indexOf(t)===-1&&e.push(t)}function Qn(e){return e.filter(function(t,r){return e.indexOf(t)===r})}function ea(e){return e.split("-")[0]}function mt(e){return[].slice.call(e)}function tr(e){return Object.keys(e).reduce(function(t,r){return e[r]!==void 0&&(t[r]=e[r]),t},{})}function nt(){return document.createElement("div")}function yt(e){return["Element","Fragment"].some(function(t){return Ft(e,t)})}function ta(e){return Ft(e,"NodeList")}function ra(e){return Ft(e,"MouseEvent")}function na(e){return!!(e&&e._tippy&&e._tippy.reference===e)}function aa(e){return yt(e)?[e]:ta(e)?mt(e):Array.isArray(e)?e:mt(document.querySelectorAll(e))}function Ot(e,t){e.forEach(function(r){r&&(r.style.transitionDuration=t+"ms")})}function rr(e,t){e.forEach(function(r){r&&r.setAttribute("data-state",t)})}function ia(e){var t,r=ze(e),a=r[0];return a!=null&&(t=a.ownerDocument)!=null&&t.body?a.ownerDocument:document}function oa(e,t){var r=t.clientX,a=t.clientY;return e.every(function(i){var u=i.popperRect,s=i.popperState,p=i.props,l=p.interactiveBorder,h=ea(s.placement),v=s.modifiersData.offset;if(!v)return!0;var A=h==="bottom"?v.top.y:0,C=h==="top"?v.bottom.y:0,g=h==="right"?v.left.x:0,w=h==="left"?v.right.x:0,T=u.top-a+A>l,E=a-u.bottom-C>l,k=u.left-r+g>l,L=r-u.right-w>l;return T||E||k||L})}function Ct(e,t,r){var a=t+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(i){e[a](i,r)})}function nr(e,t){for(var r=t;r;){var a;if(e.contains(r))return!0;r=r.getRootNode==null||(a=r.getRootNode())==null?void 0:a.host}return!1}var Ee={isTouch:!1},ar=0;function sa(){Ee.isTouch||(Ee.isTouch=!0,window.performance&&document.addEventListener("mousemove",Ar))}function Ar(){var e=performance.now();e-ar<20&&(Ee.isTouch=!1,document.removeEventListener("mousemove",Ar)),ar=e}function la(){var e=document.activeElement;if(na(e)){var t=e._tippy;e.blur&&!t.state.isVisible&&e.blur()}}function ca(){document.addEventListener("touchstart",sa,He),window.addEventListener("blur",la)}var ua=typeof window<"u"&&typeof document<"u",fa=ua?!!window.msCrypto:!1,pa={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},da={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},ge=Object.assign({appendTo:xr,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},pa,da),va=Object.keys(ge),ma=function(t){var r=Object.keys(t);r.forEach(function(a){ge[a]=t[a]})};function Or(e){var t=e.plugins||[],r=t.reduce(function(a,i){var u=i.name,s=i.defaultValue;if(u){var p;a[u]=e[u]!==void 0?e[u]:(p=ge[u])!=null?p:s}return a},{});return Object.assign({},e,r)}function ha(e,t){var r=t?Object.keys(Or(Object.assign({},ge,{plugins:t}))):va,a=r.reduce(function(i,u){var s=(e.getAttribute("data-tippy-"+u)||"").trim();if(!s)return i;if(u==="content")i[u]=s;else try{i[u]=JSON.parse(s)}catch{i[u]=s}return i},{});return a}function ir(e,t){var r=Object.assign({},t,{content:Tr(t.content,[e])},t.ignoreAttributes?{}:ha(e,t.plugins));return r.aria=Object.assign({},ge.aria,r.aria),r.aria={expanded:r.aria.expanded==="auto"?t.interactive:r.aria.expanded,content:r.aria.content==="auto"?t.interactive?null:"describedby":r.aria.content},r}var ga=function(){return"innerHTML"};function It(e,t){e[ga()]=t}function or(e){var t=nt();return e===!0?t.className=wr:(t.className=Er,yt(e)?t.appendChild(e):It(t,e)),t}function sr(e,t){yt(t.content)?(It(e,""),e.appendChild(t.content)):typeof t.content!="function"&&(t.allowHTML?It(e,t.content):e.textContent=t.content)}function Bt(e){var t=e.firstElementChild,r=mt(t.children);return{box:t,content:r.find(function(a){return a.classList.contains(br)}),arrow:r.find(function(a){return a.classList.contains(wr)||a.classList.contains(Er)}),backdrop:r.find(function(a){return a.classList.contains(Jn)})}}function Cr(e){var t=nt(),r=nt();r.className=Kn,r.setAttribute("data-state","hidden"),r.setAttribute("tabindex","-1");var a=nt();a.className=br,a.setAttribute("data-state","hidden"),sr(a,e.props),t.appendChild(r),r.appendChild(a),i(e.props,e.props);function i(u,s){var p=Bt(t),l=p.box,h=p.content,v=p.arrow;s.theme?l.setAttribute("data-theme",s.theme):l.removeAttribute("data-theme"),typeof s.animation=="string"?l.setAttribute("data-animation",s.animation):l.removeAttribute("data-animation"),s.inertia?l.setAttribute("data-inertia",""):l.removeAttribute("data-inertia"),l.style.maxWidth=typeof s.maxWidth=="number"?s.maxWidth+"px":s.maxWidth,s.role?l.setAttribute("role",s.role):l.removeAttribute("role"),(u.content!==s.content||u.allowHTML!==s.allowHTML)&&sr(h,e.props),s.arrow?v?u.arrow!==s.arrow&&(l.removeChild(v),l.appendChild(or(s.arrow))):l.appendChild(or(s.arrow)):v&&l.removeChild(v)}return{popper:t,onUpdate:i}}Cr.$$tippy=!0;var ya=1,pt=[],Lt=[];function ba(e,t){var r=ir(e,Object.assign({},ge,Or(tr(t)))),a,i,u,s=!1,p=!1,l=!1,h=!1,v,A,C,g=[],w=Qt(Ue,r.interactiveDebounce),T,E=ya++,k=null,L=Qn(r.plugins),R={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},o={id:E,reference:e,popper:nt(),popperInstance:k,props:r,state:R,plugins:L,clearDelayTimeouts:n,setProps:d,setContent:m,show:b,hide:O,hideWithInteractivity:S,enable:Re,disable:Le,unmount:I,destroy:W};if(!r.render)return o;var N=r.render(o),f=N.popper,M=N.onUpdate;f.setAttribute("data-tippy-root",""),f.id="tippy-"+o.id,o.popper=f,e._tippy=o,f._tippy=o;var G=L.map(function(c){return c.fn(o)}),j=e.hasAttribute("aria-expanded");return Ce(),te(),X(),_("onCreate",[o]),r.showOnCreate&&H(),f.addEventListener("mouseenter",function(){o.props.interactive&&o.state.isVisible&&o.clearDelayTimeouts()}),f.addEventListener("mouseleave",function(){o.props.interactive&&o.props.trigger.indexOf("mouseenter")>=0&&ee().addEventListener("mousemove",w)}),o;function P(){var c=o.props.touch;return Array.isArray(c)?c:[c,0]}function U(){return P()[0]==="hold"}function V(){var c;return!!((c=o.props.render)!=null&&c.$$tippy)}function F(){return T||e}function ee(){var c=F().parentNode;return c?ia(c):document}function J(){return Bt(f)}function Y(c){return o.state.isMounted&&!o.state.isVisible||Ee.isTouch||v&&v.type==="focus"?0:At(o.props.delay,c?0:1,ge.delay)}function X(c){c===void 0&&(c=!1),f.style.pointerEvents=o.props.interactive&&!c?"":"none",f.style.zIndex=""+o.props.zIndex}function _(c,y,x){if(x===void 0&&(x=!0),G.forEach(function(B){B[c]&&B[c].apply(B,y)}),x){var D;(D=o.props)[c].apply(D,y)}}function Z(){var c=o.props.aria;if(c.content){var y="aria-"+c.content,x=f.id,D=ze(o.props.triggerTarget||e);D.forEach(function(B){var re=B.getAttribute(y);if(o.state.isVisible)B.setAttribute(y,re?re+" "+x:x);else{var ue=re&&re.replace(x,"").trim();ue?B.setAttribute(y,ue):B.removeAttribute(y)}})}}function te(){if(!(j||!o.props.aria.expanded)){var c=ze(o.props.triggerTarget||e);c.forEach(function(y){o.props.interactive?y.setAttribute("aria-expanded",o.state.isVisible&&y===F()?"true":"false"):y.removeAttribute("aria-expanded")})}}function ve(){ee().removeEventListener("mousemove",w),pt=pt.filter(function(c){return c!==w})}function K(c){if(!(Ee.isTouch&&(l||c.type==="mousedown"))){var y=c.composedPath&&c.composedPath()[0]||c.target;if(!(o.props.interactive&&nr(f,y))){if(ze(o.props.triggerTarget||e).some(function(x){return nr(x,y)})){if(Ee.isTouch||o.state.isVisible&&o.props.trigger.indexOf("click")>=0)return}else _("onClickOutside",[o,c]);o.props.hideOnClick===!0&&(o.clearDelayTimeouts(),o.hide(),p=!0,setTimeout(function(){p=!1}),o.state.isMounted||Q())}}}function be(){l=!0}function se(){l=!1}function ie(){var c=ee();c.addEventListener("mousedown",K,!0),c.addEventListener("touchend",K,He),c.addEventListener("touchstart",se,He),c.addEventListener("touchmove",be,He)}function Q(){var c=ee();c.removeEventListener("mousedown",K,!0),c.removeEventListener("touchend",K,He),c.removeEventListener("touchstart",se,He),c.removeEventListener("touchmove",be,He)}function Oe(c,y){me(c,function(){!o.state.isVisible&&f.parentNode&&f.parentNode.contains(f)&&y()})}function le(c,y){me(c,y)}function me(c,y){var x=J().box;function D(B){B.target===x&&(Ct(x,"remove",D),y())}if(c===0)return y();Ct(x,"remove",A),Ct(x,"add",D),A=D}function we(c,y,x){x===void 0&&(x=!1);var D=ze(o.props.triggerTarget||e);D.forEach(function(B){B.addEventListener(c,y,x),g.push({node:B,eventType:c,handler:y,options:x})})}function Ce(){U()&&(we("touchstart",Ie,{passive:!0}),we("touchend",Ve,{passive:!0})),Zn(o.props.trigger).forEach(function(c){if(c!=="manual")switch(we(c,Ie),c){case"mouseenter":we("mouseleave",Ve);break;case"focus":we(fa?"focusout":"blur",Be);break;case"focusin":we("focusout",Be);break}})}function Fe(){g.forEach(function(c){var y=c.node,x=c.eventType,D=c.handler,B=c.options;y.removeEventListener(x,D,B)}),g=[]}function Ie(c){var y,x=!1;if(!(!o.state.isEnabled||Ne(c)||p)){var D=((y=v)==null?void 0:y.type)==="focus";v=c,T=c.currentTarget,te(),!o.state.isVisible&&ra(c)&&pt.forEach(function(B){return B(c)}),c.type==="click"&&(o.props.trigger.indexOf("mouseenter")<0||s)&&o.props.hideOnClick!==!1&&o.state.isVisible?x=!0:H(c),c.type==="click"&&(s=!x),x&&!D&&he(c)}}function Ue(c){var y=c.target,x=F().contains(y)||f.contains(y);if(!(c.type==="mousemove"&&x)){var D=q().concat(f).map(function(B){var re,ue=B._tippy,qe=(re=ue.popperInstance)==null?void 0:re.state;return qe?{popperRect:B.getBoundingClientRect(),popperState:qe,props:r}:null}).filter(Boolean);oa(D,c)&&(ve(),he(c))}}function Ve(c){var y=Ne(c)||o.props.trigger.indexOf("click")>=0&&s;if(!y){if(o.props.interactive){o.hideWithInteractivity(c);return}he(c)}}function Be(c){o.props.trigger.indexOf("focusin")<0&&c.target!==F()||o.props.interactive&&c.relatedTarget&&f.contains(c.relatedTarget)||he(c)}function Ne(c){return Ee.isTouch?U()!==c.type.indexOf("touch")>=0:!1}function We(){Ge();var c=o.props,y=c.popperOptions,x=c.placement,D=c.offset,B=c.getReferenceClientRect,re=c.moveTransition,ue=V()?Bt(f).arrow:null,qe=B?{getBoundingClientRect:B,contextElement:B.contextElement||F()}:e,Vt={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(ct){var Xe=ct.state;if(V()){var Ir=J(),Tt=Ir.box;["placement","reference-hidden","escaped"].forEach(function(ut){ut==="placement"?Tt.setAttribute("data-placement",Xe.placement):Xe.attributes.popper["data-popper-"+ut]?Tt.setAttribute("data-"+ut,""):Tt.removeAttribute("data-"+ut)}),Xe.attributes.popper={}}}},Me=[{name:"offset",options:{offset:D}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!re}},Vt];V()&&ue&&Me.push({name:"arrow",options:{element:ue,padding:3}}),Me.push.apply(Me,y?.modifiers||[]),o.popperInstance=zn(qe,f,Object.assign({},y,{placement:x,onFirstUpdate:C,modifiers:Me}))}function Ge(){o.popperInstance&&(o.popperInstance.destroy(),o.popperInstance=null)}function ce(){var c=o.props.appendTo,y,x=F();o.props.interactive&&c===xr||c==="parent"?y=x.parentNode:y=Tr(c,[x]),y.contains(f)||y.appendChild(f),o.state.isMounted=!0,We()}function q(){return mt(f.querySelectorAll("[data-tippy-root]"))}function H(c){o.clearDelayTimeouts(),c&&_("onTrigger",[o,c]),ie();var y=Y(!0),x=P(),D=x[0],B=x[1];Ee.isTouch&&D==="hold"&&B&&(y=B),y?a=setTimeout(function(){o.show()},y):o.show()}function he(c){if(o.clearDelayTimeouts(),_("onUntrigger",[o,c]),!o.state.isVisible){Q();return}if(!(o.props.trigger.indexOf("mouseenter")>=0&&o.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(c.type)>=0&&s)){var y=Y(!1);y?i=setTimeout(function(){o.state.isVisible&&o.hide()},y):u=requestAnimationFrame(function(){o.hide()})}}function Re(){o.state.isEnabled=!0}function Le(){o.hide(),o.state.isEnabled=!1}function n(){clearTimeout(a),clearTimeout(i),cancelAnimationFrame(u)}function d(c){if(!o.state.isDestroyed){_("onBeforeUpdate",[o,c]),Fe();var y=o.props,x=ir(e,Object.assign({},y,tr(c),{ignoreAttributes:!0}));o.props=x,Ce(),y.interactiveDebounce!==x.interactiveDebounce&&(ve(),w=Qt(Ue,x.interactiveDebounce)),y.triggerTarget&&!x.triggerTarget?ze(y.triggerTarget).forEach(function(D){D.removeAttribute("aria-expanded")}):x.triggerTarget&&e.removeAttribute("aria-expanded"),te(),X(),M&&M(y,x),o.popperInstance&&(We(),q().forEach(function(D){requestAnimationFrame(D._tippy.popperInstance.forceUpdate)})),_("onAfterUpdate",[o,c])}}function m(c){o.setProps({content:c})}function b(){var c=o.state.isVisible,y=o.state.isDestroyed,x=!o.state.isEnabled,D=Ee.isTouch&&!o.props.touch,B=At(o.props.duration,0,ge.duration);if(!(c||y||x||D)&&!F().hasAttribute("disabled")&&(_("onShow",[o],!1),o.props.onShow(o)!==!1)){if(o.state.isVisible=!0,V()&&(f.style.visibility="visible"),X(),ie(),o.state.isMounted||(f.style.transition="none"),V()){var re=J(),ue=re.box,qe=re.content;Ot([ue,qe],0)}C=function(){var Me;if(!(!o.state.isVisible||h)){if(h=!0,f.offsetHeight,f.style.transition=o.props.moveTransition,V()&&o.props.animation){var xt=J(),ct=xt.box,Xe=xt.content;Ot([ct,Xe],B),rr([ct,Xe],"visible")}Z(),te(),er(Lt,o),(Me=o.popperInstance)==null||Me.forceUpdate(),_("onMount",[o]),o.props.animation&&V()&&le(B,function(){o.state.isShown=!0,_("onShown",[o])})}},ce()}}function O(){var c=!o.state.isVisible,y=o.state.isDestroyed,x=!o.state.isEnabled,D=At(o.props.duration,1,ge.duration);if(!(c||y||x)&&(_("onHide",[o],!1),o.props.onHide(o)!==!1)){if(o.state.isVisible=!1,o.state.isShown=!1,h=!1,s=!1,V()&&(f.style.visibility="hidden"),ve(),Q(),X(!0),V()){var B=J(),re=B.box,ue=B.content;o.props.animation&&(Ot([re,ue],D),rr([re,ue],"hidden"))}Z(),te(),o.props.animation?V()&&Oe(D,o.unmount):o.unmount()}}function S(c){ee().addEventListener("mousemove",w),er(pt,w),w(c)}function I(){o.state.isVisible&&o.hide(),o.state.isMounted&&(Ge(),q().forEach(function(c){c._tippy.unmount()}),f.parentNode&&f.parentNode.removeChild(f),Lt=Lt.filter(function(c){return c!==o}),o.state.isMounted=!1,_("onHidden",[o]))}function W(){o.state.isDestroyed||(o.clearDelayTimeouts(),o.unmount(),Fe(),delete e._tippy,o.state.isDestroyed=!0,_("onDestroy",[o]))}}function lt(e,t){t===void 0&&(t={});var r=ge.plugins.concat(t.plugins||[]);ca();var a=Object.assign({},t,{plugins:r}),i=aa(e),u=i.reduce(function(s,p){var l=p&&ba(p,a);return l&&s.push(l),s},[]);return yt(e)?u[0]:u}lt.defaultProps=ge;lt.setDefaultProps=ma;lt.currentInput=Ee;Object.assign({},fr,{effect:function(t){var r=t.state,a={popper:{position:r.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(r.elements.popper.style,a.popper),r.styles=a,r.elements.arrow&&Object.assign(r.elements.arrow.style,a.arrow)}});lt.setDefaultProps({render:Cr});function wa(e,t){const r=document.getElementById(`${e}`);r&&lt(r,{content:t,theme:"battlesystem"})}function Ea(){const e=new Map;e.set("tip_opacity","Change the opacity of the background of a label."),e.set("tip_textsize","Change the text size of the label name."),e.set("tip_stroke","Change the player-indication color stroke around the label."),e.set("exportButton","Export your current label set to a JSON file, for sharing or saving."),e.set("importButton","Import a JSON text file and overwrite your current Label set."),e.set("saveButton","Save changes to your Labels so they are available to be used."),e.set("addButton","Add another label row to the list for a new item."),e.set("resetButton","Reset your labels back to the default state."),e.forEach((t,r)=>{wa(r,t)})}var ye=(function(){/*!
* Copyright (c) 2021-2023 Momo Bassit.
* Licensed under the MIT License (MIT)
* https://github.com/mdbassit/Coloris
* Version: 0.19.0
* NPM: https://github.com/melloware/coloris-npm
*/return(function(e,t,r){var a=t.createElement("canvas").getContext("2d"),i={r:0,g:0,b:0,h:0,s:0,v:0,a:1},u,s,p,l,h,v,A,C,g,w,T,E,k,L,R,o,N,f={el:"[data-coloris]",parent:"body",theme:"default",themeMode:"light",rtl:!1,wrap:!0,margin:2,format:"hex",formatToggle:!1,swatches:[],swatchesOnly:!1,alpha:!0,forceAlpha:!1,focusInput:!0,selectInput:!1,inline:!1,defaultColor:"#000000",clearButton:!1,clearLabel:"Clear",closeButton:!1,closeLabel:"Close",onChange:function(){},a11y:{open:"Open color picker",close:"Close color picker",clear:"Clear the selected color",marker:"Saturation: {s}. Brightness: {v}.",hueSlider:"Hue slider",alphaSlider:"Opacity slider",input:"Color value field",format:"Color format",swatch:"Color swatch",instruction:"Saturation and brightness selector. Use up, down, left and right arrow keys to select."}},M={},G="",j={},P=!1;function U(n){if(typeof n=="object"){var d=function(){switch(m){case"el":Y(n.el),n.wrap!==!1&&_(n.el);break;case"parent":u=t.querySelector(n.parent),u&&(u.appendChild(s),f.parent=n.parent,u===t.body&&(u=null));break;case"themeMode":f.themeMode=n.themeMode,n.themeMode==="auto"&&e.matchMedia&&e.matchMedia("(prefers-color-scheme: dark)").matches&&(f.themeMode="dark");case"theme":n.theme&&(f.theme=n.theme),s.className="clr-picker clr-"+f.theme+" clr-"+f.themeMode,f.inline&&X();break;case"rtl":f.rtl=!!n.rtl,t.querySelectorAll(".clr-field").forEach(function(D){return D.classList.toggle("clr-rtl",f.rtl)});break;case"margin":n.margin*=1,f.margin=isNaN(n.margin)?f.margin:n.margin;break;case"wrap":n.el&&n.wrap&&_(n.el);break;case"formatToggle":f.formatToggle=!!n.formatToggle,q("clr-format").style.display=f.formatToggle?"block":"none",f.formatToggle&&(f.format="auto");break;case"swatches":if(Array.isArray(n.swatches)){var O=[];n.swatches.forEach(function(D,B){O.push('<button type="button" id="clr-swatch-'+B+'" aria-labelledby="clr-swatch-label clr-swatch-'+B+'" style="color: '+D+';">'+D+"</button>")}),q("clr-swatches").innerHTML=O.length?"<div>"+O.join("")+"</div>":"",f.swatches=n.swatches.slice()}break;case"swatchesOnly":f.swatchesOnly=!!n.swatchesOnly,s.setAttribute("data-minimal",f.swatchesOnly);break;case"alpha":f.alpha=!!n.alpha,s.setAttribute("data-alpha",f.alpha);break;case"inline":if(f.inline=!!n.inline,s.setAttribute("data-inline",f.inline),f.inline){var S=n.defaultColor||f.defaultColor;R=ve(S),X(),te(S)}break;case"clearButton":typeof n.clearButton=="object"&&(n.clearButton.label&&(f.clearLabel=n.clearButton.label,C.innerHTML=f.clearLabel),n.clearButton=n.clearButton.show),f.clearButton=!!n.clearButton,C.style.display=f.clearButton?"block":"none";break;case"clearLabel":f.clearLabel=n.clearLabel,C.innerHTML=f.clearLabel;break;case"closeButton":f.closeButton=!!n.closeButton,f.closeButton?s.insertBefore(g,v):v.appendChild(g);break;case"closeLabel":f.closeLabel=n.closeLabel,g.innerHTML=f.closeLabel;break;case"a11y":var I=n.a11y,W=!1;if(typeof I=="object")for(var c in I)I[c]&&f.a11y[c]&&(f.a11y[c]=I[c],W=!0);if(W){var y=q("clr-open-label"),x=q("clr-swatch-label");y.innerHTML=f.a11y.open,x.innerHTML=f.a11y.swatch,g.setAttribute("aria-label",f.a11y.close),C.setAttribute("aria-label",f.a11y.clear),w.setAttribute("aria-label",f.a11y.hueSlider),E.setAttribute("aria-label",f.a11y.alphaSlider),A.setAttribute("aria-label",f.a11y.input),p.setAttribute("aria-label",f.a11y.instruction)}break;default:f[m]=n[m]}};for(var m in n)d()}}function V(n,d){typeof n=="string"&&typeof d=="object"&&(M[n]=d,P=!0)}function F(n){delete M[n],Object.keys(M).length===0&&(P=!1,n===G&&J())}function ee(n){if(P){var d=["el","wrap","rtl","inline","defaultColor","a11y"],m=function(){var I=M[b];if(n.matches(b)){G=b,j={},d.forEach(function(c){return delete I[c]});for(var W in I)j[W]=Array.isArray(f[W])?f[W].slice():f[W];return U(I),"break"}};for(var b in M){var O=m();if(O==="break")break}}}function J(){Object.keys(j).length>0&&(U(j),G="",j={})}function Y(n){H(t,"click",n,function(d){f.inline||(ee(d.target),L=d.target,o=L.value,R=ve(o),s.classList.add("clr-open"),X(),te(o),(f.focusInput||f.selectInput)&&A.focus({preventScroll:!0}),f.selectInput&&A.select(),(N||f.swatchesOnly)&&ce().shift().focus(),L.dispatchEvent(new Event("open",{bubbles:!0})))}),H(t,"input",n,function(d){var m=d.target.parentNode;m.classList.contains("clr-field")&&(m.style.color=d.target.value)})}function X(){if(!(!s||!L&&!f.inline)){var n=u,d=e.scrollY,m=s.offsetWidth,b=s.offsetHeight,O={left:!1,top:!1},S,I,W,c={x:0,y:0};if(n&&(S=e.getComputedStyle(n),I=parseFloat(S.marginTop),W=parseFloat(S.borderTopWidth),c=n.getBoundingClientRect(),c.y+=W+d),!f.inline){var y=L.getBoundingClientRect(),x=y.x,D=d+y.y+y.height+f.margin;n?(x-=c.x,D-=c.y,x+m>n.clientWidth&&(x+=y.width-m,O.left=!0),D+b>n.clientHeight-I&&b+f.margin<=y.top-(c.y-d)&&(D-=y.height+b+f.margin*2,O.top=!0),D+=n.scrollTop):(x+m>t.documentElement.clientWidth&&(x+=y.width-m,O.left=!0),D+b-d>t.documentElement.clientHeight&&b+f.margin<=y.top&&(D=d+y.y-b-f.margin,O.top=!0)),s.classList.toggle("clr-left",O.left),s.classList.toggle("clr-top",O.top),s.style.left=x+"px",s.style.top=D+"px",c.x+=s.offsetLeft,c.y+=s.offsetTop}l={width:p.offsetWidth,height:p.offsetHeight,x:p.offsetLeft+c.x,y:p.offsetTop+c.y}}}function _(n){t.querySelectorAll(n).forEach(function(d){var m=d.parentNode;if(!m.classList.contains("clr-field")){var b=t.createElement("div"),O="clr-field";(f.rtl||d.classList.contains("clr-rtl"))&&(O+=" clr-rtl"),b.innerHTML='<button type="button" aria-labelledby="clr-open-label"></button>',m.insertBefore(b,d),b.setAttribute("class",O),b.style.color=d.value,b.appendChild(d)}})}function Z(n){if(L&&!f.inline){var d=L;n&&(L=null,o!==d.value&&(d.value=o,d.dispatchEvent(new Event("input",{bubbles:!0})))),setTimeout(function(){o!==d.value&&d.dispatchEvent(new Event("change",{bubbles:!0}))}),s.classList.remove("clr-open"),P&&J(),d.dispatchEvent(new Event("close",{bubbles:!0})),f.focusInput&&d.focus({preventScroll:!0}),L=null}}function te(n){var d=Ve(n),m=Ue(d);se(m.s,m.v),me(d,m),w.value=m.h,s.style.color="hsl("+m.h+", 100%, 50%)",T.style.left=m.h/360*100+"%",h.style.left=l.width*m.s/100+"px",h.style.top=l.height-l.height*m.v/100+"px",E.value=m.a*100,k.style.left=m.a*100+"%"}function ve(n){var d=n.substring(0,3).toLowerCase();return d==="rgb"||d==="hsl"?d:"hex"}function K(n){n=n!==void 0?n:A.value,L&&(L.value=n,L.dispatchEvent(new Event("input",{bubbles:!0}))),f.onChange&&f.onChange.call(e,n),t.dispatchEvent(new CustomEvent("coloris:pick",{detail:{color:n}}))}function be(n,d){var m={h:w.value*1,s:n/l.width*100,v:100-d/l.height*100,a:E.value/100},b=Fe(m);se(m.s,m.v),me(b,m),K()}function se(n,d){var m=f.a11y.marker;n=n.toFixed(1)*1,d=d.toFixed(1)*1,m=m.replace("{s}",n),m=m.replace("{v}",d),h.setAttribute("aria-label",m)}function ie(n){return{pageX:n.changedTouches?n.changedTouches[0].pageX:n.pageX,pageY:n.changedTouches?n.changedTouches[0].pageY:n.pageY}}function Q(n){var d=ie(n),m=d.pageX-l.x,b=d.pageY-l.y;u&&(b+=u.scrollTop),le(m,b),n.preventDefault(),n.stopPropagation()}function Oe(n,d){var m=h.style.left.replace("px","")*1+n,b=h.style.top.replace("px","")*1+d;le(m,b)}function le(n,d){n=n<0?0:n>l.width?l.width:n,d=d<0?0:d>l.height?l.height:d,h.style.left=n+"px",h.style.top=d+"px",be(n,d),h.focus()}function me(n,d){n===void 0&&(n={}),d===void 0&&(d={});var m=f.format;for(var b in n)i[b]=n[b];for(var O in d)i[O]=d[O];var S=Be(i),I=S.substring(0,7);switch(h.style.color=I,k.parentNode.style.color=I,k.style.color=S,v.style.color=S,p.style.display="none",p.offsetHeight,p.style.display="",k.nextElementSibling.style.display="none",k.nextElementSibling.offsetHeight,k.nextElementSibling.style.display="",m==="mixed"?m=i.a===1?"hex":"rgb":m==="auto"&&(m=R),m){case"hex":A.value=S;break;case"rgb":A.value=Ne(i);break;case"hsl":A.value=We(Ie(i));break}t.querySelector('.clr-format [value="'+m+'"]').checked=!0}function we(){var n=w.value*1,d=h.style.left.replace("px","")*1,m=h.style.top.replace("px","")*1;s.style.color="hsl("+n+", 100%, 50%)",T.style.left=n/360*100+"%",be(d,m)}function Ce(){var n=E.value/100;k.style.left=n*100+"%",me({a:n}),K()}function Fe(n){var d=n.s/100,m=n.v/100,b=d*m,O=n.h/60,S=b*(1-r.abs(O%2-1)),I=m-b;b=b+I,S=S+I;var W=r.floor(O)%6,c=[b,S,I,I,S,b][W],y=[S,b,b,S,I,I][W],x=[I,I,S,b,b,S][W];return{r:r.round(c*255),g:r.round(y*255),b:r.round(x*255),a:n.a}}function Ie(n){var d=n.v/100,m=d*(1-n.s/100/2),b;return m>0&&m<1&&(b=r.round((d-m)/r.min(m,1-m)*100)),{h:n.h,s:b||0,l:r.round(m*100),a:n.a}}function Ue(n){var d=n.r/255,m=n.g/255,b=n.b/255,O=r.max(d,m,b),S=r.min(d,m,b),I=O-S,W=O,c=0,y=0;return I&&(O===d&&(c=(m-b)/I),O===m&&(c=2+(b-d)/I),O===b&&(c=4+(d-m)/I),O&&(y=I/O)),c=r.floor(c*60),{h:c<0?c+360:c,s:r.round(y*100),v:r.round(W*100),a:n.a}}function Ve(n){var d=/^((rgba)|rgb)[\D]+([\d.]+)[\D]+([\d.]+)[\D]+([\d.]+)[\D]*?([\d.]+|$)/i,m,b;return a.fillStyle="#000",a.fillStyle=n,m=d.exec(a.fillStyle),m?(b={r:m[3]*1,g:m[4]*1,b:m[5]*1,a:m[6]*1},b.a=+b.a.toFixed(2)):(m=a.fillStyle.replace("#","").match(/.{2}/g).map(function(O){return parseInt(O,16)}),b={r:m[0],g:m[1],b:m[2],a:1}),b}function Be(n){var d=n.r.toString(16),m=n.g.toString(16),b=n.b.toString(16),O="";if(n.r<16&&(d="0"+d),n.g<16&&(m="0"+m),n.b<16&&(b="0"+b),f.alpha&&(n.a<1||f.forceAlpha)){var S=n.a*255|0;O=S.toString(16),S<16&&(O="0"+O)}return"#"+d+m+b+O}function Ne(n){return!f.alpha||n.a===1&&!f.forceAlpha?"rgb("+n.r+", "+n.g+", "+n.b+")":"rgba("+n.r+", "+n.g+", "+n.b+", "+n.a+")"}function We(n){return!f.alpha||n.a===1&&!f.forceAlpha?"hsl("+n.h+", "+n.s+"%, "+n.l+"%)":"hsla("+n.h+", "+n.s+"%, "+n.l+"%, "+n.a+")"}function Ge(){t.getElementById("clr-picker")||(u=null,s=t.createElement("div"),s.setAttribute("id","clr-picker"),s.className="clr-picker",s.innerHTML='<input id="clr-color-value" name="clr-color-value" class="clr-color" type="text" value="" spellcheck="false" aria-label="'+f.a11y.input+'">'+('<div id="clr-color-area" class="clr-gradient" role="application" aria-label="'+f.a11y.instruction+'">')+'<div id="clr-color-marker" class="clr-marker" tabindex="0"></div></div><div class="clr-hue">'+('<input id="clr-hue-slider" name="clr-hue-slider" type="range" min="0" max="360" step="1" aria-label="'+f.a11y.hueSlider+'">')+'<div id="clr-hue-marker"></div></div><div class="clr-alpha">'+('<input id="clr-alpha-slider" name="clr-alpha-slider" type="range" min="0" max="100" step="1" aria-label="'+f.a11y.alphaSlider+'">')+'<div id="clr-alpha-marker"></div><span></span></div><div id="clr-format" class="clr-format"><fieldset class="clr-segmented">'+("<legend>"+f.a11y.format+"</legend>")+'<input id="clr-f1" type="radio" name="clr-format" value="hex"><label for="clr-f1">Hex</label><input id="clr-f2" type="radio" name="clr-format" value="rgb"><label for="clr-f2">RGB</label><input id="clr-f3" type="radio" name="clr-format" value="hsl"><label for="clr-f3">HSL</label><span></span></fieldset></div><div id="clr-swatches" class="clr-swatches"></div>'+('<button type="button" id="clr-clear" class="clr-clear" aria-label="'+f.a11y.clear+'">'+f.clearLabel+"</button>")+'<div id="clr-color-preview" class="clr-preview">'+('<button type="button" id="clr-close" class="clr-close" aria-label="'+f.a11y.close+'">'+f.closeLabel+"</button>")+"</div>"+('<span id="clr-open-label" hidden>'+f.a11y.open+"</span>")+('<span id="clr-swatch-label" hidden>'+f.a11y.swatch+"</span>"),t.body.appendChild(s),p=q("clr-color-area"),h=q("clr-color-marker"),C=q("clr-clear"),g=q("clr-close"),v=q("clr-color-preview"),A=q("clr-color-value"),w=q("clr-hue-slider"),T=q("clr-hue-marker"),E=q("clr-alpha-slider"),k=q("clr-alpha-marker"),Y(f.el),_(f.el),H(s,"mousedown",function(n){s.classList.remove("clr-keyboard-nav"),n.stopPropagation()}),H(p,"mousedown",function(n){H(t,"mousemove",Q)}),H(p,"touchstart",function(n){t.addEventListener("touchmove",Q,{passive:!1})}),H(h,"mousedown",function(n){H(t,"mousemove",Q)}),H(h,"touchstart",function(n){t.addEventListener("touchmove",Q,{passive:!1})}),H(A,"change",function(n){(L||f.inline)&&(te(A.value),K())}),H(C,"click",function(n){K(""),Z()}),H(g,"click",function(n){K(),Z()}),H(t,"click",".clr-format input",function(n){R=n.target.value,me(),K()}),H(s,"click",".clr-swatches button",function(n){te(n.target.textContent),K(),f.swatchesOnly&&Z()}),H(t,"mouseup",function(n){t.removeEventListener("mousemove",Q)}),H(t,"touchend",function(n){t.removeEventListener("touchmove",Q)}),H(t,"mousedown",function(n){N=!1,s.classList.remove("clr-keyboard-nav"),Z()}),H(t,"keydown",function(n){var d=n.key,m=n.target,b=n.shiftKey,O=["Tab","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"];if(d==="Escape"?Z(!0):O.includes(d)&&(N=!0,s.classList.add("clr-keyboard-nav")),d==="Tab"&&m.matches(".clr-picker *")){var S=ce(),I=S.shift(),W=S.pop();b&&m===I?(W.focus(),n.preventDefault()):!b&&m===W&&(I.focus(),n.preventDefault())}}),H(t,"click",".clr-field button",function(n){P&&J(),n.target.nextElementSibling.dispatchEvent(new Event("click",{bubbles:!0}))}),H(h,"keydown",function(n){var d={ArrowUp:[0,-1],ArrowDown:[0,1],ArrowLeft:[-1,0],ArrowRight:[1,0]};Object.keys(d).includes(n.key)&&(Oe.apply(void 0,d[n.key]),n.preventDefault())}),H(p,"click",Q),H(w,"input",we),H(E,"input",Ce))}function ce(){var n=Array.from(s.querySelectorAll("input, button")),d=n.filter(function(m){return!!m.offsetWidth});return d}function q(n){return t.getElementById(n)}function H(n,d,m,b){var O=Element.prototype.matches||Element.prototype.msMatchesSelector;typeof m=="string"?n.addEventListener(d,function(S){O.call(S.target,m)&&b.call(S.target,S)}):(b=m,n.addEventListener(d,b))}function he(n,d){d=d!==void 0?d:[],t.readyState!=="loading"?n.apply(void 0,d):t.addEventListener("DOMContentLoaded",function(){n.apply(void 0,d)})}NodeList!==void 0&&NodeList.prototype&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach);function Re(n,d){L=d,o=L.value,ee(d),R=ve(n),X(),te(n),K(),o!==n&&L.dispatchEvent(new Event("change",{bubbles:!0}))}var Le=(function(){var n={init:Ge,set:U,wrap:_,close:Z,setInstance:V,setColor:Re,removeInstance:F,updatePosition:X};function d(O){he(function(){O&&(typeof O=="string"?Y(O):U(O))})}var m=function(S){d[S]=function(){for(var I=arguments.length,W=new Array(I),c=0;c<I;c++)W[c]=arguments[c];he(n[S],W)}};for(var b in n)m(b);return he(function(){e.addEventListener("resize",function(O){d.updatePosition()}),e.addEventListener("scroll",function(O){d.updatePosition()})}),d})();return Le.coloris=Le,Le})(window,document,Math)})();ye.coloris;ye.init;ye.set;ye.wrap;ye.close;ye.setInstance;ye.removeInstance;ye.updatePosition;ye.init();ye.coloris({el:".coloris",alpha:!1,format:"hex",wrap:!0,theme:"polaroid",themeMode:"light",swatches:["red","yellow","green","cyan","blue","purple"],onChange:()=>{}});ye.close();const Lr=document.getElementById("loadingApp"),xa=document.getElementById("labelApp"),kr=document.getElementById("label-list"),Ta=document.getElementById("labelSort");let kt=!0;const _e=document.getElementById("mainButtons"),bt=document.getElementById("gr1n"),wt=document.getElementById("gr2n"),Et=document.getElementById("gr3n"),ke=document.getElementById("distance"),De=document.getElementById("opacity"),Pe=document.getElementById("stroke");let Ye=[];async function lr(){Vr();const e=await $.theme.getTheme();Wt(e,document),$.theme.onChange(r=>{Wt(r,document)}),Ye=await $.scene.items.getItems(),$.scene.items.onChange(r=>{Ye=r}),$.player.onChange(async r=>{if(r.selection?.length===1){const a=r.selection[0],i=Ye.find(u=>u.id===a&&(u.metadata[`${z.EXTENSIONID}/addId`]!==void 0||u.metadata[`${z.EXTENSIONID}/minusId`]!==void 0));if(i){Ye.length===0&&(Ye=await $.scene.items.getItems());const u=Ye.find(s=>i.attachedTo===s.metadata[`${z.EXTENSIONID}/counterId`]);if(u){let s=u?parseInt(u.text.plainText):1;s=i.metadata[`${z.EXTENSIONID}/addId`]!==void 0?s+1:s-1,s===0&&u.attachedTo?await $.scene.items.deleteItems([u.attachedTo]):(s>9&&(s=9),await $.scene.items.updateItems([u.id],p=>{for(let l of p)l.text.plainText=s.toString()}),$.player.deselect([i.id]))}}}}),await $.player.getRole()==="GM"?(await Rr(),document.getElementById("patreonContainer").appendChild(Mr()),await Sa(),Wr(),Ea()):(Lr.innerHTML='<div class="player-view">Configuration is GM-Access only.</div>',await $.action.setHeight(70),await $.action.setWidth(150)),setTimeout(async()=>{const r=Hr().fillColor("black").plainText("You found me. ").fillOpacity(0).strokeWidth(0).strokeColor("white").strokeOpacity(0).build();r.position={x:-5e3,y:-5e3},r.visible=!1,r.locked=!0,r.disableHit=!0,r.type="TEXT",r.text.type="PLAIN",r.text.style.fontWeight=100,r.text.style.fontSize=12,r.text.style.textAlign="CENTER",r.text.style.fontFamily="Roboto",await $.scene.items.addItems([r]),await $.scene.items.getItemBounds([r.id]),setTimeout(async()=>{await $.scene.items.deleteItems([r.id])},1e3)},1e3)}function ht(e){const t=kr.insertRow(0);t.className="data-row",t.id=Pr();const r=t.insertCell(0);r.innerHTML=`<input id="checkbox_${t.id}" type="checkbox" ${e?.Active===0?"":"checked"}/>`;const a=t.insertCell(1);a.id="name_"+t.id,a.setAttribute("contenteditable","true"),a.innerHTML=e?e.Name:"Default Name";const i=t.insertCell(2);i.className="center";const u=Ca();u.value=e?e.Group:"#1",u.id="group_"+t.id,i.appendChild(u);const s=t.insertCell(3);s.className="center";const p=Oa();p.value=e?e.Direction:"Top",p.id="selector_"+t.id,s.appendChild(p);const l=t.insertCell(4);l.id=t.id,l.className="center";const h=t.insertCell(5);h.innerHTML=`<input id="counter${t.id}" type="checkbox" ${e?.Counter===1?"checked":""}/>`;const v=e?$r(e.Color):void 0;l.appendChild(Aa(l.id,v))}function Aa(e,t){const r=document.createElement("div"),a=document.createElement("button");a.setAttribute("aria-labelledby","clr-open-label"),a.id="clr-button_"+e,r.className="clr-field",r.id="clr-field_"+e,r.style.color=t?"rgb"+t:"rgb(0, 0, 0)",r.appendChild(a);const i=document.createElement("input");return i.type="text",i.id="clr-input_"+e,i.style.width="20px",i.className="coloris",i.setAttribute("data-coloris",""),r.appendChild(i),r}function Oa(){const e=document.createElement("select");return e.className="directionSelect",["Top","Bottom","Left","Right"].forEach(r=>{const a=document.createElement("option");a.setAttribute("value",r);const i=document.createTextNode(r);a.appendChild(i),e.appendChild(a)}),e}function Ca(){const e=document.createElement("select");return e.className="groupSelect",["#1","#2","#3"].forEach(r=>{const a=document.createElement("option");a.setAttribute("value",r);const i=document.createTextNode(r);a.appendChild(i),e.appendChild(a)}),e}async function La(){const e=Dr();var t=document.createElement("a"),r=new Blob([JSON.stringify(e)],{type:"text/plain"});t.href=URL.createObjectURL(r),t.download=`MarkedExport-${Date.now()}`,document.body.appendChild(t),t.click(),document.body.removeChild(t)}async function ka(e){if(e&&e.Labels?.length>0){const t=document.getElementById("label-list");t.innerHTML="",e.Labels.forEach(r=>{ht(r)}),e.Groups.forEach(r=>{switch(r.Num){case"#1":bt.value=r.Name;break;case"#2":wt.value=r.Name;break;case"#3":Et.value=r.Name;break;default:throw new Error("Invalid Group")}}),ke.value=e.Distance,De.value=e.Opacity}await Ut()}async function Ut(){const e=Dr();let t={};t[`${z.EXTENSIONID}/metadata_marks`]={saveData:e},await $.room.setMetadata(t)}function Dr(){const e=[],t=[],r=ke.value,a=De.value,i=Pe.value;for(var u=document.getElementById("label-list"),s=0,p;p=u.rows[s];s++){const l=p.id,h=p.querySelector("#checkbox_"+l),v=p.querySelector("#name_"+l),A=p.querySelector("#selector_"+l),C=p.querySelector("#group_"+l),g=p.querySelector("#clr-field_"+l),w=p.querySelector("#counter"+l),T=jr(g.style.color),E={Id:l,Active:h.checked?1:0,Name:v.innerText.trim(),Direction:A.value,Color:T,Group:C.value,Counter:w.checked?1:0};e.push(E)}return t.push({Name:bt.value,Num:"#1"}),t.push({Name:wt.value,Num:"#2"}),t.push({Name:Et.value,Num:"#3"}),{Groups:t,Labels:e.reverse(),Distance:r,Opacity:a,Stroke:i}}async function Da(){confirm("Erase everything and go back to default labels?")&&(kr.innerHTML="",await Sr())}async function Sr(){bt.value=z.DEFAULTGROUP[0],wt.value=z.DEFAULTGROUP[1],Et.value=z.DEFAULTGROUP[2],ke.value=z.DEFAULTFONTSIZE,De.value=z.DEFAULTOPACITY,Pe.value=z.DEFAULTSTROKE,z.DEFAULTSET.forEach(e=>{ht(e)}),await Ut()}async function Sa(){const r=(await $.room.getMetadata())[`${z.EXTENSIONID}/metadata_marks`]?.saveData;r&&r.Labels?.length>0?(r.Labels.forEach(g=>{ht(g)}),r.Groups.forEach(g=>{switch(g.Num){case"#1":bt.value=g.Name;break;case"#2":wt.value=g.Name;break;case"#3":Et.value=g.Name;break;default:throw new Error("Invalid Group")}})):await Sr(),ke.max="999",ke.min="1",ke.maxLength=4,ke.value=r?.Distance?r.Distance:z.DEFAULTFONTSIZE,ke.oninput=g=>{v(g.target)},De.max="99",De.min="1",De.maxLength=2,De.value=r?.Opacity?r.Opacity:z.DEFAULTOPACITY,De.oninput=g=>{v(g.target)},Pe.max="20",Pe.min="0",Pe.maxLength=2,Pe.value=r?.Stroke?r.Stroke:z.DEFAULTSTROKE,Pe.oninput=g=>{v(g.target)};const a=document.createElement("input");a.type="image",a.className="Icon clickable",a.id="exportButton",a.onclick=async function(){await La()},a.src="/export.svg",a.title="Export Data",a.height=20,a.width=20,_e.appendChild(a);const i=document.createElement("input");i.type="image",i.className="Icon clickable",i.id="importButton",i.onclick=async function(){document.getElementById("fileButton").click()},i.src="/import.svg",i.title="Import Data",i.height=20,i.width=20,_e.appendChild(i);const u=document.createElement("input");u.type="file",u.id="fileButton",u.title="Choose a file to import",u.className="tinyType",u.hidden=!0,u.onchange=async function(){if(console.log("FILE ADDED"),u.files&&u.files.length>0){let g=u.files[0],w=new FileReader;w.readAsText(g),w.onload=async function(){try{const T=JSON.parse(w.result);await ka(T),$.notification.show("Import Complete!","SUCCESS")}catch(T){$.notification.show(`The import failed - ${T}`,"ERROR")}},w.onerror=function(){console.log(w.error)}}},_e.appendChild(u);const s=document.createElement("input");s.type="image",s.className="Icon clickable",s.id="saveButton",s.onclick=async function(){await Ut()},s.src="/save.svg",s.title="Save Changes",s.height=20,s.width=20,_e.appendChild(s);const p=document.createElement("input");p.type="image",p.className="Icon clickable",p.id="addButton",p.onclick=async function(){await ht()},p.src="/add.svg",p.title="Add Label",p.height=20,p.width=20,_e.appendChild(p);const l=document.createElement("input");l.type="image",l.className="Icon clickable",l.id="resetButton",l.onclick=async function(){await Da()},l.src="/reset.svg",l.title="Reset to Default Labels",l.height=20,l.width=20,_e.appendChild(l),Ta.onclick=async function(){var g,w,T,E,k,L,R;for(g=document.getElementById("label-list"),T=!0;T;){for(T=!1,w=g.getElementsByClassName("data-row"),E=0;E<w.length-1;E++)if(R=!1,k=w[E].getElementsByTagName("td")[1],L=w[E+1].getElementsByTagName("td")[1],kt){if(k.innerHTML.toLowerCase()>L.innerHTML.toLowerCase()){R=!0;break}}else if(k.innerHTML.toLowerCase()<L.innerHTML.toLowerCase()){R=!0;break}R&&(w[E].parentNode.insertBefore(w[E+1],w[E]),T=!0)}kt=!kt},Lr.style.display="none",xa.style.display="";function h(g){return parseInt(g)}function v(g){let w=g.min,T=g.max,E=h(g.value);E>T?g.value=T:E<w&&(g.value=w)}function A(g){g.preventDefault();const w=g.target.closest("tr");w&&w.rowIndex>0&&window.confirm(`Are you sure you want to delete ${w.children[1].innerHTML}?`)&&w.remove()}const C=document.getElementById("table-one");C&&C.addEventListener("contextmenu",A)}await $.onReady(async()=>{if(await $.scene.isReady()===!1){const t=$.scene.onReadyChange(async r=>{r&&(t(),await lr())})}else await lr()});
